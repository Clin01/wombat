<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hi</title>
    <link href="mocha.css" rel="stylesheet"/>
    <style>
        #wombatSandboxContainer {
            display: none;
        }

        #wombatSandbox {
            display: none;
        }
    </style>
</head>
<body>
<div id="mocha"></div>
<div id="wombatSandboxContainer"></div>
<script src="test-setup-bundle.js" type="text/javascript"></script>
<script>
  mocha.setup({
    ui: 'bdd',
    ignoreLeaks: true
  });

  function initTestContext ({init} = {init: false}) {
   return async function () {
     let wombatIf = await window.wombatTestUtil.addWombatSandbox();
     /**
      * @type {{window: Window | null, document: Document | null}}
      */
     this.wombatSandbox = {
       window: wombatIf.contentWindow,
       document: wombatIf.contentDocument
     };

     const testSelf = this;
     this._$internalHelper = {
       validTestTitles: {
         '"before all" hook': true,
         '"before" hook': true
       },
       checkValidCall () {
         if (!this.validTestTitles[testSelf.test.title]) {
           console.log(this.validTestTitles, testSelf.test.title)
           throw new Error(`Invalid usage of internal helpers at ${testSelf.test.title}`);
         }
       },
       async refresh () {
         this.checkValidCall();
         wombatIf = await window.wombatTestUtil.refreshSandbox();
         testSelf.wombatSandbox.window = wombatIf.contentWindow;
         testSelf.wombatSandbox.document = wombatIf.contentDocument;
       },
       async refreshInit () {
         await this.refresh();
         this.init();
       },
       init () {
         testSelf.wombatSandbox.window._WBWombat(testSelf.wombatSandbox.window, testSelf.wombatSandbox.window.wbinfo);
       }
     };
     if (init) {
       await this._$internalHelper.refreshInit();
     }
   }
  }
</script>
<script>
  wbinfo = {}
  wbinfo.app_prefix = decodeURI(window.location.href);
  wbinfo.content_prefix = decodeURI(window.location.href);
  wbinfo.prefix = decodeURI(window.location.href);
  wbinfo.coll = "archival-acid-test-v2";
  wbinfo.url = "http://wsdl-docker.cs.odu.edu:8080/cors" + window.location.hash;
  wbinfo.capture_url = wbinfo.url;
  wbinfo.request_ts = "20171006223947";
  wbinfo.timestamp = "20171006223947";
  wbinfo.is_frame = true;
  wbinfo.frame_mod = "";
  wbinfo.replay_mod = "mp_";
  wbinfo.state = "replay-coll";
  wbinfo.sources = "";
  wbinfo.inv_sources = "";
  wbinfo.info = {"user": "jberlin", "size_remaining": 8765070063, "size": 8890297, "coll_id": "archival-acid-test-v2", "coll_title": "Archival Acid Test V2", "coll_desc": ""};
  wbinfo.iframe = "#replay_iframe";
</script>
<script src="test.wombat-setup.js" type="text/javascript"></script>
<script src="test.wombat-exposed-functions.js" type="text/javascript"></script>
<script src="test.wombat-overrides.js" type="text/javascript"></script>
<script>
  mocha.run();
</script>
</body>
</html>