<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hi</title>
    <link href="mocha.css" rel="stylesheet"/>
    <style>
        #wombatSandboxContainer {
            display: none;
        }

        #wombatSandbox {
            display: none;
        }
    </style>
</head>
<body>
<div id="mocha"></div>
<div id="wombatSandboxContainer"></div>
<script src="mocha.js" type="text/javascript"></script>
<script src="chai.js" type="text/javascript"></script>
<script src="chai-dom.js" type="text/javascript"></script>
<script src="chai-string.js" type="text/javascript"></script>
<script>
  mocha.setup({
    ui: 'bdd',
    ignoreLeaks: true
  })
</script>
<script>
  wbinfo = {}
  wbinfo.app_prefix = decodeURI(window.location.href);
  wbinfo.content_prefix = decodeURI(window.location.href);
  wbinfo.prefix = decodeURI(window.location.href);
  wbinfo.coll = "archival-acid-test-v2";
  wbinfo.url = "http://wsdl-docker.cs.odu.edu:8080/cors" + window.location.hash;
  wbinfo.capture_url = wbinfo.url;
  wbinfo.request_ts = "20171006223947";
  wbinfo.timestamp = "20171006223947";
  wbinfo.is_frame = true;
  wbinfo.frame_mod = "";
  wbinfo.replay_mod = "mp_";
  wbinfo.state = "replay-coll";
  wbinfo.sources = "";
  wbinfo.inv_sources = "";
  wbinfo.info = {"user": "jberlin", "size_remaining": 8765070063, "size": 8890297, "coll_id": "archival-acid-test-v2", "coll_title": "Archival Acid Test V2", "coll_desc": ""};
  wbinfo.iframe = "#replay_iframe";
</script>
<script src="testingConstants.js" type="text/javascript"></script>
<script src="test.wombat-setup.js" type="text/javascript"></script>
<script src="test.wombat-overrides.js" type="text/javascript"></script>
<script src="test.wombat-exposed-functions.js" type="text/javascript"></script>
<script src="chaiUtils.js" type="text/javascript"></script>
<script>
  chai.use(chaiURL)
  // chai.use(chaiAsPromised)
  chai.use(chaiInterface)
  window.wombatTestUtil = {
    addedSandbox: false,
    isSandboxReady: false,
    /**
     * @return {Promise<HTMLIFrameElement>}
     */
    addWombatSandbox () {
      console.log('adding wombat sandbox')
      if (!this.addedSandbox) {
        const container = document.getElementById('wombatSandboxContainer')
        const wbif = document.createElement('iframe')
        wbif.src = 'wombatSandbox.html'
        wbif.id = 'wombatSandbox'
        container.appendChild(wbif)
        this.sandbox = wbif
        this.addedSandbox = true
        return new Promise((resolve) => {
          this.done = resolve
        })
      }
      return Promise.resolve(this.sandbox)
    },
    removeWombatSandbox () {
      if (this.addedSandbox) {
        this.sandbox = null
        document.getElementById('wombatSandbox').remove()
        this.addedSandbox = false
      }
    },
    sandboxReady () {
      if (this.done) {
        this.done(this.sandbox)
        this.done = null
      }
    },
    /**
     * @return {Promise<HTMLIFrameElement>}
     */
    refreshSandbox () {
      this.sandbox.contentWindow.location.reload()
      return new Promise((resolve) => {
        this.done = resolve
      })
    }
  }
  window.addEventListener('message', (event) => {
    if (event.data && event.data.type === 'wombat-sandbox-ready') {
      window.wombatTestUtil.sandboxReady()
    } else {
      console.log(event)
    }
  }, false)
  window.expect = chai.expect
  window.testLogger = console.log.bind(console)
  window.initTestGlobals = function(testThis) {

  }
  mocha.run()
</script>
</body>
</html>