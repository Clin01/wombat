(function(){function a(b,c){if(!(this instanceof a))return new a(b);if(this.wombat=b,this.checkIntervalTime=15e3,this.checkIntervalCB=this.checkIntervalCB.bind(this),this.checkInterval=null,this.elemSelector="img[srcset], img[data-srcset], img[data-src], video[srcset], video[data-srcset], video[data-src], audio[srcset], audio[data-srcset], audio[data-src], picture > source[srcset], picture > source[data-srcset], picture > source[data-src], video > source[srcset], video > source[data-srcset], video > source[data-src], audio > source[srcset], audio > source[data-srcset], audio > source[data-src]",this.styleTag=document.createElement("style"),this.styleTag.id="$wrStyleParser$",document.documentElement.appendChild(this.styleTag),c){var d=this;fetch(this.wombat.wbAutoFetchWorkerPrefix).then(function(a){return a.text().then(function(a){var b=new Blob([a],{type:"text/javascript"});d.worker=new d.wombat.$wbwindow.Worker(URL.createObjectURL(b)),d.startCheckingInterval()})})}else this.worker={postMessage:function(a){a.wb_type||(a={wb_type:"aaworker",msg:a}),d.wombat.$wbwindow.top.postMessage(a,"*")},terminate:function(){}},this.startCheckingInterval()}function b(a,c){return this instanceof b?void(this.wb_info=c,this.$wbwindow=a,this.wb_info.top_host=this.wb_info.top_host||"*",this.wb_info.wombat_opts=this.wb_info.wombat_opts||{},this.wbAutoFetchWorkerPrefix=(this.wb_info.auto_fetch_worker_prefix||this.wb_info.static_prefix)+"autoFetchWorkerProxyMode.js",this.WBAutoFetchWorker=null):new b(a,c)}a.prototype.resumeCheckInterval=function(){null==this.checkInterval&&(this.checkInterval=setInterval(this.checkIntervalCB,this.checkIntervalTime))},a.prototype.pauseCheckInterval=function(){null!=this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)},a.prototype.startCheckingInterval=function(){var a=this;if("complete"===this.wombat.$wbwindow.document.readyState)this.extractFromLocalDoc(),this.checkInterval=setInterval(this.checkIntervalCB,this.checkIntervalTime);else var b=setInterval(function(){"complete"===a.wombat.$wbwindow.document.readyState&&(a.extractFromLocalDoc(),clearInterval(b),a.checkInterval=setInterval(a.checkIntervalCB,a.checkIntervalTime))},1e3)},a.prototype.checkIntervalCB=function(){this.extractFromLocalDoc()},a.prototype.terminate=function(){this.worker.terminate()},a.prototype.justFetch=function(a){this.worker.postMessage({type:"fetch-all",values:a})},a.prototype.postMessage=function(a){this.worker.postMessage(a)},a.prototype.shouldSkipSheet=function(a){return!("$wrStyleParser$"!==a.id)||!!(a.href&&-1!==a.href.indexOf(wb_info.proxy_magic))},a.prototype.validateSrcV=function(a){return a&&0!==a.indexOf("data:")&&0!==a.indexOf("blob:")?a:null},a.prototype.fetchCSSAndExtract=function(a){var b=location.protocol+"//"+this.wombat.wb_info.proxy_magic+"/proxy-fetch/"+a,c=this;return fetch(b).then(function(b){return b.text().then(function(b){return c.styleTag.textContent=b,c.extractMediaRules(c.styleTag.sheet,a)})}).catch(function(){return[]})},a.prototype.extractMediaRules=function(a,b){var c=[];if(!a)return c;var d=a.cssRules||a.rules;if(!d||0===d.length)return c;for(var e,f=d.length,g=a.href||b,h=0;h<f;++h)e=d[h],e.type===CSSRule.MEDIA_RULE&&c.push({cssText:e.cssText,resolve:g});return c},a.prototype.extractSrcSrcsetFrom=function(a,b){for(var c=a.querySelectorAll(this.elemSelector),d=c.length,e={type:"values",srcset:[],src:[]},f=0;f<d;f++){var g=c[f],h=this.validateSrcV(g.src),j=h||b,k="SOURCE"===g.tagName?"PICTURE"===g.parentElement.tagName?"im_":"oe_":"IMG"===g.tagName?"im_":"oe_";g.srcset&&e.srcset.push({srcset:g.srcset,resolve:j,mod:k}),g.dataset.srcset&&e.srcset.push({srcset:g.dataset.srcset,resolve:j,mod:k}),g.dataset.src&&e.src.push({src:g.dataset.src,resolve:j,mod:k}),"SOURCE"===g.tagName&&h&&e.src.push({src:h,resolve:b,mod:k})}(e.srcset.length||e.src.length)&&this.postMessage(e)},a.prototype.checkStyleSheets=function(a){for(var b,c=[],d=[],e=a.styleSheets,f=e.length,g=0;g<f;g++)if(b=e[g],!this.shouldSkipSheet(b))try{if(b.cssRules||b.rules){var h=this.extractMediaRules(b,a.baseURI);h.length&&(c=c.concat(h))}else null!=b.href&&d.push(this.fetchCSSAndExtract(b.href))}catch(a){null!=b.href&&d.push(this.fetchCSSAndExtract(b.href))}if(c.length&&this.postMessage({type:"values",media:c}),d.length){var j=this;Promise.all(d).then(function(a){if(0!==a.length){for(var b=a.length,c=[],d=0;d<b;++d)c=c.concat(a[d]);j.postMessage({type:"values",media:c})}})}},a.prototype.extractFromLocalDoc=function(){this.extractSrcSrcsetFrom(this.wombat.$wbwindow.document,this.wombat.$wbwindow.document.baseURI),this.checkStyleSheets(this.wombat.$wbwindow.document)},b.prototype.initSeededRandom=function(a){this.$wbwindow.Math.seed=parseInt(a);var b=this;this.$wbwindow.Math.random=function(){return b.$wbwindow.Math.seed=(9301*b.$wbwindow.Math.seed+49297)%233280,b.$wbwindow.Math.seed/233280}},b.prototype.initCryptoRandom=function(){if(this.$wbwindow.crypto&&this.$wbwindow.Crypto){var a=this,b=function(b){for(var c=0;c<b.length;c++)b[c]=parseInt(4294967296*a.$wbwindow.Math.random());return b};this.$wbwindow.Crypto.prototype.getRandomValues=b,this.$wbwindow.crypto.getRandomValues=b}},b.prototype.initFixedRatio=function(){try{this.$wbwindow.devicePixelRatio=1}catch(a){}if(Object.defineProperty)try{Object.defineProperty(this.$wbwindow,"devicePixelRatio",{value:1,writable:!1})}catch(a){}},b.prototype.initDateOverride=function(a){if(!this.$wbwindow.__wb_Date_now){var b=1e3*parseInt(a),c=this.$wbwindow.Date.now(),d=c-(b-0),e=this.$wbwindow.Date,f=this.$wbwindow.Date.UTC,g=this.$wbwindow.Date.parse,h=this.$wbwindow.Date.now;this.$wbwindow.__wb_Date_now=h,this.$wbwindow.Date=function(a){return function(b,c,e,f,g,i,j){return void 0===b?new a(h()-d):void 0===c?new a(b):void 0===e?new a(b,c):void 0===f?new a(b,c,e):void 0===g?new a(b,c,e,f):void 0===i?new a(b,c,e,f,g):void 0===j?new a(b,c,e,f,g,i):new a(b,c,e,f,g,i,j)}}(this.$wbwindow.Date),this.$wbwindow.Date.prototype=e.prototype,this.$wbwindow.Date.now=function(){return h()-d},this.$wbwindow.Date.UTC=f,this.$wbwindow.Date.parse=g,this.$wbwindow.Date.__WB_timediff=d,Object.defineProperty(this.$wbwindow.Date.prototype,"constructor",{value:this.$wbwindow.Date})}},b.prototype.initDisableNotifications=function(){if(window.Notification&&(window.Notification.requestPermission=function(a){return a&&a("denied"),Promise.resolve("denied")}),window.geolocation){var a=function(a,b){b&&b({code:2,message:"not available"})};window.geolocation.getCurrentPosition=a,window.geolocation.watchPosition=a}},b.prototype.initAutoFetchWorker=function(){if(this.$wbwindow.Worker){var b=this.$wbwindow.self===this.$wbwindow.top;if(null==this.$wbwindow.$WBAutoFetchWorker$?(this.WBAutoFetchWorker=new a(this,b),Object.defineProperty(this.$wbwindow,"$WBAutoFetchWorker$",{enumerable:!1,value:this.WBAutoFetchWorker})):this.WBAutoFetchWorker=this.$wbwindow.$WBAutoFetchWorker$,b){var c=this;this.$wbwindow.addEventListener("message",function(a){a.data&&"aaworker"===a.data.wb_type&&c.WBAutoFetchWorker.postMessage(a.data.msg)},!1)}}},b.prototype.wombat_init=function(){return this.wb_info.enable_auto_fetch&&this.wb_info.is_live&&this.initAutoFetchWorker(),this.initSeededRandom(this.wb_info.wombat_sec),this.initCryptoRandom(),this.initFixedRatio(),this.initDateOverride(this.wb_info.wombat_sec),this.initDisableNotifications(),{actual:!1}},window._WBWombat=b,window._WBWombatInit=function(a){if(!this._wb_wombat||!this._wb_wombat.actual){var c=new b(this,a);c.actual=!0,this._wb_wombat=c.wombat_init(),this._wb_wombat.actual=!0}else this._wb_wombat||console.warn("_wb_wombat missing!")}})();
