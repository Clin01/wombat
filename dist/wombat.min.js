(function(){function e(){this._map=[]}function t(e){switch(typeof e){case"number":case"bigint":return 0<=e?e:null;case"string":return isNaN(e)?null:+e;default:try{var t=+e;return isNaN(t)?null:t}catch(t){return null}}}function r(e,t){"undefined"!=typeof self.Symbol&&"undefined"!=typeof self.Symbol.toStringTag&&Object.defineProperty(e.prototype,self.Symbol.toStringTag,{value:t,enumerable:!1,configurable:!0,writable:!0})}function o(e,t){Object.defineProperties(this,{data:{enumerable:!1,value:{}},wombat:{enumerable:!1,value:e},proxying:{enumerable:!1,value:t}})}function i(e,t){for(var r in Object.defineProperties(this,{_orig_loc:{configurable:!0,enumerable:!1,value:e},wombat:{configurable:!0,enumerable:!1,value:t}}),t.initLocOverride(this,this.orig_setter,this.orig_getter),t.setLoc(this,e.href),e)this.hasOwnProperty(r)||"function"==typeof e[r]||(this[r]=e[r])}function n(e){if(!(this instanceof n))return new n(e);if(this.elemSelector="img[srcset], img[data-srcset], img[data-src], video[srcset], video[data-srcset], video[data-src], audio[srcset], audio[data-srcset], audio[data-src], picture > source[srcset], picture > source[data-srcset], picture > source[data-src], video > source[srcset], video > source[data-srcset], video > source[data-src], audio > source[srcset], audio > source[data-srcset], audio > source[data-src]",this.isTop=e.$wbwindow===e.$wbwindow.__WB_replay_top,this.wombat=e,this.$wbwindow=e.$wbwindow,this.isTop){var t=(e.wb_info.auto_fetch_worker_prefix||e.wb_info.static_prefix)+"autoFetchWorker.js?init="+encodeURIComponent(JSON.stringify({mod:e.wb_info.mod,prefix:e.wb_abs_prefix,rwRe:e.wb_unrewrite_rx}));this.worker=new this.$wbwindow.Worker(t)}else this.worker={postMessage:function(t){t.wb_type||(t={wb_type:"aaworker",msg:t}),e.$wbwindow.__WB_replay_top.__orig_postMessage(t,"*")},terminate:function(){}}}function w(e,t){return function(r){return window===t?e(r):void 0}}function a(e,t,r){return function(o){var i;if(o.data&&o.data.from&&o.data.message){if("*"!==o.data.to_origin&&t.WB_wombat_location&&!r.startsWith(o.data.to_origin,t.WB_wombat_location.origin))return void console.warn("Skipping message event to "+o.data.to_origin+" doesn't start with origin "+t.WB_wombat_location.origin);var n=o.source;o.data.from_top?n=t.__WB_top_frame:o.data.src_id&&t.__WB_win_id&&t.__WB_win_id[o.data.src_id]&&(n=t.__WB_win_id[o.data.src_id]),i=new MessageEvent("message",{bubbles:o.bubbles,cancelable:o.cancelable,data:o.data.message,origin:o.data.from,lastEventId:o.lastEventId,source:r.proxyToObj(n),ports:o.ports}),i._target=o.target,i._srcElement=o.srcElement,i._currentTarget=o.currentTarget,i._eventPhase=o.eventPhase,i._path=o.path}else i=o;return e(i)}}function p(t,r){return this instanceof p?void(this.actual=!1,this.debug_rw=!1,this.$wbwindow=t,this.HTTP_PREFIX="http://",this.HTTPS_PREFIX="https://",this.REL_PREFIX="//",this.VALID_PREFIXES=[this.HTTP_PREFIX,this.HTTPS_PREFIX,this.REL_PREFIX],this.IGNORE_PREFIXES=["#","about:","data:","mailto:","javascript:","{","*"],this.wb_setAttribute=t.Element.prototype.setAttribute,this.wb_getAttribute=t.Element.prototype.getAttribute,this.wb_funToString=Function.prototype.toString,this.WBAutoFetchWorker=null,this.wbSheetMediaQChecker=null,this.wbUseAFWorker=r.enable_auto_fetch&&null!=t.Worker&&r.is_live,this.wb_rel_prefix="",this.wb_wombat_updating=!1,this.message_listeners=new e,this.storage_listeners=new e,this.linkAsTypes={script:"js_",worker:"js_",style:"cs_",image:"im_",document:"if_",fetch:"mp_",font:"oe_",audio:"oe_",video:"oe_",embed:"oe_",object:"oe_",track:"oe_"},this.tagToMod={A:{href:void 0},AREA:{href:void 0},IMG:{src:"im_",srcset:"im_"},IFRAME:{src:"if_"},FRAME:{src:"fr_"},SCRIPT:{src:"js_"},VIDEO:{src:"oe_",poster:"im_"},AUDIO:{src:"oe_",poster:"im_"},SOURCE:{src:"oe_",srcset:"oe_"},INPUT:{src:"oe_"},EMBED:{src:"oe_"},OBJECT:{data:"oe_"},BASE:{href:"mp_"},META:{content:"mp_"},FORM:{action:"mp_"},TRACK:{src:"oe_"}},this.URL_PROPS=["href","hash","pathname","host","hostname","protocol","origin","search","port"],this.wb_info=r,this.wb_opts=r.wombat_opts,this.wb_replay_prefix=r.prefix,this.wb_is_proxy=this.wb_info.proxy_magic||!this.wb_replay_prefix,this.wb_info.top_host=this.wb_info.top_host||"*",this.wb_curr_host=t.location.protocol+"//"+t.location.host,this.wb_info.wombat_opts=this.wb_info.wombat_opts||{},this.wb_orig_scheme=this.wb_info.wombat_scheme+"://",this.wb_orig_origin=this.wb_orig_scheme+this.wb_info.wombat_host,this.wb_abs_prefix=this.wb_replay_prefix,this.wb_capture_date_part=!this.wb_info.is_live&&this.wb_info.wombat_ts?"/"+this.wb_info.wombat_ts+"/":"",this.BAD_PREFIXES=["http:"+this.wb_replay_prefix,"https:"+this.wb_replay_prefix,"http:/"+this.wb_replay_prefix,"https:/"+this.wb_replay_prefix],this.hostnamePortRe=/^[\w-]+(\.[\w-_]+)+(:\d+)(\/|$)/,this.ipPortRe=/^\d+\.\d+\.\d+\.\d+(:\d+)?(\/|$)/,this.workerBlobRe=/__WB_pmw\(.*?\)\.(?=postMessage\()/g,this.STYLE_REGEX=/(url\s*\(\s*[\\"']*)([^)'"]+)([\\"']*\s*\))/gi,this.IMPORT_REGEX=/(@import\s+[\\"']*)([^)'";]+)([\\"']*\s*;?)/gi,this.no_wombatRe=/WB_wombat_/g,this.srcsetRe=/\s*(\S*\s+[\d.]+[wx]),|(?:\s*,(?:\s+|(?=https?:)))/,this.cookie_path_regex=/\bPath='?"?([^;'"\s]+)/i,this.cookie_domain_regex=/\bDomain=([^;'"\s]+)/i,this.cookie_expires_regex=/\bExpires=([^;'"]+)/gi,this.IP_RX=/^(\d)+\.(\d)+\.(\d)+\.(\d)+$/,this.FullHTMLRegex=/^\s*<(?:html|head|body|!doctype html)/i,this.DotPostMessageRe=/(.postMessage\s*\()/,this.write_buff="",this.styleReplacer=this.styleReplacer.bind(this),this.utilFns={}):new p(t,r)}e.prototype.set=function(e,t){this._map.push([e,t])},e.prototype.get=function(e){for(var t=0;t<this._map.length;t++)if(this._map[t][0]===e)return this._map[t][1];return null},e.prototype.find=function(e){for(var t=0;t<this._map.length;t++)if(this._map[t][0]===e)return t;return-1},e.prototype.add_or_get=function(e,t){var r=this.get(e);return r||(r=t(),this.set(e,r)),r},e.prototype.remove=function(e){var t=this.find(e);if(0<=t){var r=this._map.splice(t,1);return r[0][1]}return null},e.prototype.map=function(e){for(var t=0;t<this._map.length;t++)this._map[t][1](e)},o.prototype.getItem=function(e){return this.data.hasOwnProperty(e)?this.data[e]:null},o.prototype.setItem=function(e,t){var r=e+"",o=this.getItem(r);return this.data[r]=t,void this.fireEvent(r,o,t+"")},o.prototype.removeItem=function(e){var t=this.getItem(e),r=delete this.data[e];this.fireEvent(e,t,null)},o.prototype.clear=function(){return this.data={},void this.fireEvent(null,null,null)},o.prototype.key=function(e){var r=t(e);if(null==r||0>r)return null;var o=Object.keys(this.data);return r<o.length?null:o[r]},o.prototype.fireEvent=function(e,t,r){var o=new StorageEvent("storage",{key:e,newValue:r,oldValue:t,url:this.wombat.$wbwindow.WB_wombat_location.href,storageArea:this.wombat.$wbwindow[this.proxying]});o._storageArea=this,this.wombat.storage_listeners.map(o)},o.prototype.valueOf=function(){return this.wombat.$wbwindow[this.proxying]},Object.defineProperty(o.prototype,"length",{get:function(){return Object.keys(this.data).length}}),r(o,"Storage"),i.prototype.replace=function(e){var t=this.wombat.rewriteUrl(e),r=this.wombat.extractOriginalURL(t);return r===this.href?r:this._orig_loc.replace(t)},i.prototype.assign=function(e){var t=this.wombat.rewriteUrl(e),r=this.wombat.extractOriginalURL(t);return r===this.href?r:this._orig_loc.assign(t)},i.prototype.reload=function(){return this._orig_loc.reload()},i.prototype.orig_getter=function(e){return this._orig_loc[e]},i.prototype.orig_setter=function(e,t){this._orig_loc[e]=t},i.prototype.toString=function(){return this.href},i.prototype.valueOf=function(){return this},r(i,"Location"),n.prototype.deferredSheetExtraction=function(e){var t=e.cssRules||e.rules;if(t&&0!==t.length){var r=this;Promise.resolve().then(function(){for(var e,o=[],n=0;n<t.length;++n)e=t[n],e.type===CSSRule.MEDIA_RULE&&o.push(e.cssText);0<o.length&&r.preserveMedia(o)})}},n.prototype.terminate=function(){this.worker.terminate()},n.prototype.postMessage=function(e,t){if(t){var r=this;return Promise.resolve().then(function(){r.worker.postMessage(e)})}this.worker.postMessage(e)},n.prototype.preserveSrcset=function(e,t){this.postMessage({type:"values",srcset:{values:e,mod:t,presplit:!0}},!0)},n.prototype.preserveDataSrcset=function(e){this.postMessage({type:"values",srcset:{value:e.dataset.srcset,mod:this.rwMod(e),presplit:!1}},!0)},n.prototype.preserveMedia=function(e){this.postMessage({type:"values",media:e},!0)},n.prototype.getSrcset=function(e){return this.wombat.wb_getAttribute?this.wombat.wb_getAttribute.call(e,"srcset"):e.getAttribute("srcset")},n.prototype.rwMod=function(e){return"SOURCE"===e.tagName?"PICTURE"===e.parentElement.tagName?"im_":"oe_":"IMG"===e.tagName?"im_":"oe_"},n.prototype.extractFromLocalDoc=function(){var e=this;Promise.resolve().then(function(){for(var t={type:"values",context:{docBaseURI:e.$wbwindow.document.baseURI}},r=[],o=0,n=e.$wbwindow.document.styleSheets;o<n.length;++o)for(var w,a=n[o].cssRules,p=0;p<a.length;++p)w=a[p],w.type===CSSRule.MEDIA_RULE&&r.push(w.cssText);var _,d,s,l=e.$wbwindow.document.querySelectorAll(e.elemSelector),b={values:[],presplit:!1},c={values:[]};for(o=0;o<l.length;++o)_=l[o],d=_.src?_.src:null,s=e.rwMod(_),_.srcset&&b.values.push({srcset:e.getSrcset(_),mod:s,tagSrc:d}),_.dataset.srcset&&b.values.push({srcset:_.dataset.srcset,mod:s,tagSrc:d}),_.dataset.src&&c.values.push({src:_.dataset.src,mod:s}),"SOURCE"===_.tagName&&d&&c.values.push({src:d,mod:s});r.length&&(t.media=r),b.values.length&&(t.srcset=b),c.values.length&&(t.src=c),(t.media||t.srcset||t.src)&&e.postMessage(t)})},p.prototype.isSavedSrcSrcset=function(e){switch(e.tagName){case"IMG":case"VIDEO":case"AUDIO":return!0;case"SOURCE":if(!e.parentElement)return!1;switch(e.parentElement.tagName){case"PICTURE":case"VIDEO":case"AUDIO":return!0;default:return!1;}default:return!1;}},p.prototype.isSavedDataSrcSrcset=function(e){return!!(e.dataset&&null!=e.dataset.srcset)&&this.isSavedSrcSrcset(e)},p.prototype.isHostUrl=function(e){if(0===e.indexOf("www."))return!0;var t=e.match(this.hostnamePortRe);return!!(t&&64>t[0].length)||(t=e.match(this.ipPortRe),!!t&&64>t[0].length)},p.prototype.startsWith=function(e,t){return e?0===e.indexOf(t)?t:void 0:void 0},p.prototype.startsWithOneOf=function(e,t){if(e)for(var r=0;r<t.length;r++)if(0===e.indexOf(t[r]))return t[r]},p.prototype.endsWith=function(e,t){return e?-1===e.indexOf(t,e.length-t.length)?void 0:t:void 0},p.prototype.shouldRewriteAttr=function(e,t){return!("href"!==t&&"src"!==t)||!("META"!==e||"content"!==t)||"VIDEO"===e&&"poster"===t},p.prototype.rwModForElement=function(e,t){if(e){var r;if("LINK"===e.tagName&&"href"===t){var o=e.rel;if("import"===o||"preload"===o){var i=this.linkAsTypes[e.as];r=null==i?"mp_":i}else"stylesheet"===o&&(r="cs_")}else{var n=this.tagToMod[e.tagName];null!=n&&(r=n[t])}return r}},p.prototype.removeWBOSRC=function(e){"SCRIPT"!==e.tagName||e.__$removedWBOSRC$__||(e.hasAttribute("__wb_orig_src")&&e.removeAttribute("__wb_orig_src"),e.__$removedWBOSRC$__=!0)},p.prototype.retrieveWBOSRC=function(e){if("SCRIPT"===e.tagName&&!e.__$removedWBOSRC$__){var t;return t=this.wb_getAttribute?this.wb_getAttribute.call(e,"__wb_orig_src"):e.getAttribute("__wb_orig_src"),t}},p.prototype.wrapScriptTextJsProxy=function(e){return"var _____WB$wombat$assign$function_____ = function(name) {return (self._wb_wombat && self._wb_wombat.local_init &&self._wb_wombat.local_init(name)) || self[name]; };\nif (!self.__WB_pmw) { self.__WB_pmw = function(obj) { return obj; } }\n{\nlet window = _____WB$wombat$assign$function_____(\"window\");\nlet self = _____WB$wombat$assign$function_____(\"self\");\nlet document = _____WB$wombat$assign$function_____(\"document\");\nlet location = _____WB$wombat$assign$function_____(\"location\");\nlet top = _____WB$wombat$assign$function_____(\"top\");\nlet parent = _____WB$wombat$assign$function_____(\"parent\");\nlet frames = _____WB$wombat$assign$function_____(\"frames\");\nlet opener = _____WB$wombat$assign$function_____(\"opener\");\n"+e+"\n\n}"},p.prototype.watchElem=function(e,t){if(!this.$wbwindow.MutationObserver)return!1;var r=new this.$wbwindow.MutationObserver(function(e){for(var o,n=0;n<e.length;n++)if(o=e[n],"childList"===o.type)for(var w=0;w<o.addedNodes.length;w++)t(o.addedNodes[w])});r.observe(e,{childList:!0,subtree:!0})},p.prototype.getFinalUrl=function(e,t,r){var o=e?this.wb_rel_prefix:this.wb_abs_prefix;return null==t&&(t=this.wb_info.mod),this.wb_info.is_live||(o+=this.wb_info.wombat_ts),o+=t,"/"!==o[o.length-1]&&(o+="/"),o+r},p.prototype.resolveRelUrl=function(e,t){var r=t||this.$wbwindow.document,o=this.makeParser(r.baseURI,r),i=o.href.lastIndexOf("#"),n=0<=i?o.href.substring(0,i):o.href,w=n.lastIndexOf("/");return o.href=0<=w&&w!==n.length-1?n.substring(0,w+1)+e:n+e,o.href},p.prototype.extractOriginalURL=function(e){if(!e)return"";if(this.wb_is_proxy)return e;var t=e.toString();if(this.startsWithOneOf(t,this.IGNORE_PREFIXES))return t;var r=this.wb_rel_prefix?1:0,o=t.indexOf("/http",r);return 0>o&&(o=t.indexOf("///",r)),0<=o?t=t.substr(o+1):(o=t.indexOf(this.wb_replay_prefix),0<=o&&(t=t.substr(o+this.wb_replay_prefix.length)),4<t.length&&"_"===t.charAt(2)&&"/"===t.charAt(3)&&(t=t.substr(4)),t!==e&&!this.startsWithOneOf(t,this.VALID_PREFIXES)&&(t=this.wb_orig_scheme+t)),"/"===e.charAt(0)&&"/"!==e.charAt(1)&&this.startsWith(t,this.wb_orig_origin)&&(t=t.substr(this.wb_orig_origin.length)),this.startsWith(t,this.REL_PREFIX)?this.wb_info.wombat_scheme+":"+t:t},p.prototype.makeParser=function(e,t){var r=this.extractOriginalURL(e),o=t;t||("about:blank"===this.$wbwindow.location.href&&this.$wbwindow.opener?o=this.$wbwindow.opener.document:o=this.$wbwindow.document);var i=o.createElement("a");return i._no_rewrite=!0,i.href=r,i},p.prototype.defProp=function(e,t,r,o,i){var n=Object.getOwnPropertyDescriptor(e,t);if(n&&!n.configurable)return!1;if(!o)return!1;var w={configurable:!0,enumerable:i||!1,get:o};r&&(w.set=r);try{return Object.defineProperty(e,t,w),!0}catch(r){return console.warn("Failed to redefine property %s",t,r.message),!1}},p.prototype.getOrigGetter=function(e,t){var r;if(e.__lookupGetter__&&(r=e.__lookupGetter__(t)),!r&&Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);o&&(r=o.get)}return r},p.prototype.getOrigSetter=function(e,t){var r;if(e.__lookupSetter__&&(r=e.__lookupSetter__(t)),!r&&Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);o&&(r=o.set)}return r},p.prototype.getAllOwnProps=function(e){for(var t=[],r=Object.getOwnPropertyNames(e),o=0;o<r.length;o++){var n=r[o];try{e[n]&&!e[n].prototype&&t.push(n)}catch(t){}}for(var w=Object.getPrototypeOf(e);w;){for(r=Object.getOwnPropertyNames(w),o=0;o<r.length;o++)t.push(r[o]);w=Object.getPrototypeOf(w)}return t},p.prototype.sendTopMessage=function(e,t){this.$wbwindow.__WB_top_frame&&(t||this.$wbwindow==this.$wbwindow.__WB_replay_top)&&this.$wbwindow.__WB_top_frame.postMessage(e,this.wb_info.top_host)},p.prototype.sendHistoryUpdate=function(e,t){this.sendTopMessage({url:e,ts:this.wb_info.timestamp,request_ts:this.wb_info.request_ts,is_live:this.wb_info.is_live,title:t,wb_type:"replace-url"})},p.prototype.updateLocation=function(e,t,r){if(e&&e!==t){var o=this.extractOriginalURL(t),i=this.extractOriginalURL(e);if(o&&o!==i){var n=this.rewriteUrl(e);console.log(r.href+" -> "+n),r.href=n}}},p.prototype.checkLocationChange=function(e,t){var r=typeof e,o=t?this.$wbwindow.__WB_replay_top.location:this.$wbwindow.location;"string"==r?this.updateLocation(e,o.href,o):"object"==r&&this.updateLocation(e.href,e._orig_href,o)},p.prototype.checkAllLocations=function(){return!this.wb_wombat_updating&&void(this.wb_wombat_updating=!0,this.checkLocationChange(this.$wbwindow.WB_wombat_location,!1),this.$wbwindow.WB_wombat_location!==this.$wbwindow.__WB_replay_top.WB_wombat_location&&this.checkLocationChange(this.$wbwindow.__WB_replay_top.WB_wombat_location,!0),this.wb_wombat_updating=!1)},p.prototype.proxyToObj=function(e){try{if(e){var t=e.__WBProxyRealObj__;return t?t:e}return e}catch(t){}return e},p.prototype.objToProxy=function(e){try{if(e){var t=e._WB_wombat_obj_proxy;return t?t:e}return e}catch(t){}return e},p.prototype.defaultProxyGet=function(e,t,r){switch(t){case"__WBProxyRealObj__":return e;case"location":return e.WB_wombat_location;case"_WB_wombat_obj_proxy":return e._WB_wombat_obj_proxy;}var o=e[t],i=typeof o;if("function"===i&&-1!==r.indexOf(t))switch(t){case"requestAnimationFrame":case"cancelAnimationFrame":{var n=this.wb_funToString.call(o);if(-1===n.indexOf("[native code]"))return o}default:return o.bind(e);}else if("object"===i&&o&&o._WB_wombat_obj_proxy)return o instanceof Window&&this.initNewWindowWombat(o),o._WB_wombat_obj_proxy;return o},p.prototype.setLoc=function(e,t){var r=this.makeParser(t,e.ownerDocument);e._orig_href=t,e._parser=r;var o=r.href;e._hash=r.hash,e._href=o,e._host=r.host,e._hostname=r.hostname,e._origin=r.origin?r.origin:r.protocol+"//"+r.hostname+(r.port?":"+r.port:""),e._pathname=r.pathname,e._port=r.port,e._protocol=r.protocol,e._search=r.search,Object.defineProperty||(e.href=o,e.hash=r.hash,e.host=e._host,e.hostname=e._hostname,e.origin=e._origin,e.pathname=e._pathname,e.port=e._port,e.protocol=e._protocol,e.search=e._search)},p.prototype.makeGetLocProp=function(e,t){var r=this;return function(){if(this._no_rewrite)return t.call(this,e);var o=t.call(this,"href");return"href"===e?r.extractOriginalURL(o):(this._orig_href!==o&&r.setLoc(this,o),this["_"+e])}},p.prototype.makeSetLocProp=function(t,r,o){var i=this;return function(n){if(this._no_rewrite)return r.call(this,t,n);if(this["_"+t]!==n){if(this["_"+t]=n,!this._parser){var w=o.call(this);this._parser=i.makeParser(w,this.ownerDocument)}var a=!1;"href"===t&&"string"==typeof n&&n&&("."===n[0]?n=i.resolveRelUrl(n,this.ownerDocument):"/"===n[0]&&(1>=n.length||"/"!==n[1])&&(a=!0,n=WB_wombat_location.origin+n));try{this._parser[t]=n}catch(r){console.log("Error setting "+t+" = "+n)}"hash"===t?(n=this._parser[t],r.call(this,"hash",n)):(a=a||n===this._parser.pathname,n=i.rewriteUrl(this._parser.href,a),r.call(this,"href",n))}}},p.prototype.styleReplacer=function(e,t,r,o){return t+this.rewriteUrl(r)+o},p.prototype.replaceDomFunc=function(e){var t=this.$wbwindow.Node.prototype[e],r=this;this.$wbwindow.Node.prototype[e]=function(e,o){e&&(e.nodeType===Node.ELEMENT_NODE?(r.rewriteElem(e),(e.children||e.childNodes)&&r.recurseRewriteElem(e)):e.nodeType===Node.TEXT_NODE?"STYLE"===this.tagName&&(e.textContent=r.rewriteStyle(e.textContent)):e.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&r.recurseRewriteElem(e));var i=t.call(r.proxyToObj(this),e,o);return i&&"IFRAME"===i.tagName&&r.initIframeWombat(i),i}},p.prototype.rewriteUrl_=function(e,t,r,o){if(!e)return e;var i,n=typeof e;if("object"==n)i=e.toString();else{if("string"!=n)return e;i=e}if(this.wb_is_proxy)return this.wb_orig_scheme===this.HTTP_PREFIX&&this.startsWith(i,this.HTTPS_PREFIX)?this.HTTP_PREFIX+i.substr(this.HTTPS_PREFIX.length):this.wb_orig_scheme===this.HTTPS_PREFIX&&this.startsWith(i,this.HTTP_PREFIX)?this.HTTPS_PREFIX+i.substr(this.HTTP_PREFIX.length):i;if(i=i.replace("WB_wombat_",""),this.startsWithOneOf(i,this.IGNORE_PREFIXES))return i;if(this.wb_opts.no_rewrite_prefixes&&this.startsWithOneOf(i,this.wb_opts.no_rewrite_prefixes))return i;var w=0===i.indexOf("//")?window.location.protocol+i:i;var a=this.$wbwindow.location;if(this.startsWith(w,this.wb_replay_prefix)||this.startsWith(w,a.origin+this.wb_replay_prefix))return i;if(a.host!==a.hostname&&this.startsWith(i,a.protocol+"//"+a.hostname+"/"))return i.replace("/"+a.hostname+"/","/"+a.host+"/");if("/"===i.charAt(0)&&!this.startsWith(i,this.REL_PREFIX)){if(this.wb_capture_date_part&&0<=i.indexOf(this.wb_capture_date_part))return i;if(0===i.indexOf(this.wb_rel_prefix)&&1<i.indexOf("http")){var p=i.indexOf(":/");return 0<p&&"/"!==i[p+2]?i.substring(0,p+2)+"/"+i.substring(p+2):i}return this.getFinalUrl(!0,r,this.wb_orig_origin+i)}"."===i.charAt(0)&&(i=this.resolveRelUrl(i,o));var _=this.startsWithOneOf(i,this.VALID_PREFIXES);if(_){var d=this.$wbwindow.__WB_replay_top.location.host,s=this.$wbwindow.__WB_replay_top.location.protocol,l=_+d+"/";if(this.startsWith(i,l)){if(this.startsWith(i,this.wb_replay_prefix))return i;var b=s+"//",c=i.substring(l.length),m=!1;return 0>c.indexOf(this.wb_rel_prefix)&&0>i.indexOf("/static/")&&(c=this.getFinalUrl(!0,r,WB_wombat_location.origin+"/"+c),m=!0),_!==b&&_!==this.REL_PREFIX&&(m=!0),m&&(i=t?"":b+d,c&&"/"!==c[0]&&(i+="/"),i+=c),i}return this.getFinalUrl(t,r,i)}return _=this.startsWithOneOf(i,this.BAD_PREFIXES),_?this.getFinalUrl(t,r,this.extractOriginalURL(i)):this.isHostUrl(i)&&!this.startsWith(i,a.host+"/")?this.getFinalUrl(t,r,this.wb_orig_scheme+i):i},p.prototype.rewriteUrl=function(e,t,r,o){var i=this.rewriteUrl_(e,t,r,o);return this.debug_rw&&(e===i?console.log("NOT REWRITTEN "+e):console.log("REWRITE: "+e+" -> "+i)),i},p.prototype.rewriteAttr=function(e,t,r){var o=!1;if(!e||!e.getAttribute||e._no_rewrite||e["_"+t])return o;var i=this.wb_getAttribute.call(e,t);if(!i||this.startsWith(i,"javascript:"))return o;var n;switch(t){case"filter":n=this.rewriteInlineStyle(i);break;case"style":n=this.rewriteStyle(i);break;case"srcset":n=this.rewriteSrcset(i,e);break;default:if(r&&!this.startsWithOneOf(i,this.VALID_PREFIXES))return o;var w=this.rwModForElement(e,t);n=this.rewriteUrl(i,!1,w,e.ownerDocument),this.wbUseAFWorker&&this.isSavedDataSrcSrcset(e)&&this.WBAutoFetchWorker.preserveDataSrcset(e);}return n!==i&&(this.removeWBOSRC(e),this.wb_setAttribute.call(e,t,n),o=!0),o},p.prototype.rewriteStyle=function(e){if(!e)return e;var t=e;return"object"==typeof e&&(t=e.toString()),"string"==typeof t?t.replace(this.STYLE_REGEX,this.styleReplacer).replace(this.IMPORT_REGEX,this.styleReplacer).replace(this.no_wombatRe,""):t},p.prototype.rewriteSrcset=function(e,t){if(!e)return"";for(var r=e.split(this.srcsetRe),o=[],n=0;n<r.length;n++)r[n]&&o.push(this.rewriteUrl(r[n].trim()));return this.wbUseAFWorker&&this.isSavedSrcSrcset(t)&&this.WBAutoFetchWorker.preserveSrcset(o,this.WBAutoFetchWorker.rwMod(t)),o.join(", ")},p.prototype.rewriteFrameSrc=function(e,t){var r,o=this.wb_getAttribute.call(e,t);if(this.startsWith(o,"javascript:")&&0<=o.indexOf("WB_wombat_")){r="javascript:window.parent._wb_wombat.initNewWindowWombat(window);"+o.substr(11)}return r||(r=this.rewriteUrl(o,!1,this.rwModForElement(e,t))),r!==o&&(this.wb_setAttribute.call(e,t,r),!0)},p.prototype.rewriteScript=function(e){if(e.hasAttribute("src")||!e.textContent||!this.$wbwindow.Proxy)return this.rewriteAttr(e,"src");if(e.type&&("application/json"===e.type||-1!==e.type.indexOf("text/template")))return!1;if(0<=e.textContent.indexOf("_____WB$wombat$assign$function_____"))return!1;var t=e.textContent.trim();if(!t||0===t.indexOf("<"))return!1;for(var r=["window","self","document","location","top","parent","frames","opener"],o=!1,n=0;n<r.length;n++)if(0<=t.indexOf(r[n])){o=!0;break}return!!o&&(e.textContent=this.wrapScriptTextJsProxy(e.textContent.replace(this.DotPostMessageRe,".__WB_pmw(self.window)$1")),!0)},p.prototype.rewriteElem=function(e){var t=!1;if(!e)return t;if(e instanceof SVGElement&&e.hasAttribute("filter"))t=this.rewriteAttr(e,"filter"),t=this.rewriteAttr(e,"style")||t;else switch(e.tagName){case"META":var r=this.wb_getAttribute.call(e,"http-equiv");r&&"content-security-policy"===r.toLowerCase()&&(this.wb_setAttribute.call(e,"http-equiv","_"+r),t=!0);break;case"STYLE":var o=this.rewriteStyle(e.textContent);e.textContent!==o&&(e.textContent=o,t=!0,this.wbUseAFWorker&&null!=e.sheet&&this.WBAutoFetchWorker.deferredSheetExtraction(e.sheet));break;case"LINK":t=this.rewriteAttr(e,"href"),this.wbUseAFWorker&&"stylesheet"===e.rel&&e.addEventListener("load",this.utilFns.wbSheetMediaQChecker);break;case"IMG":t=this.rewriteAttr(e,"src"),t=this.rewriteAttr(e,"srcset")||t,t=this.rewriteAttr(e,"style")||t,this.wbUseAFWorker&&e.dataset.srcset&&this.WBAutoFetchWorker.preserveDataSrcset(e);break;case"OBJECT":t=this.rewriteAttr(e,"data",!0);break;case"FORM":t=this.rewriteAttr(e,"poster"),t=this.rewriteAttr(e,"action")||t,t=this.rewriteAttr(e,"style")||t;break;case"IFRAME":case"FRAME":t=this.rewriteFrameSrc(e,"src"),t=this.rewriteAttr(e,"style")||t;break;case"SCRIPT":t=this.rewriteScript(e);break;case"image":t=this.rewriteAttr(e,"xlink:href");break;default:{t=this.rewriteAttr(e,"src"),t=this.rewriteAttr(e,"srcset")||t,t=this.rewriteAttr(e,"href")||t,t=this.rewriteAttr(e,"style")||t,t=this.rewriteAttr(e,"poster")||t;break}}return e.getAttribute&&(e.hasAttribute("crossorigin")&&(e.removeAttribute("crossorigin"),t=!0),e.hasAttribute("integrity")&&(e.removeAttribute("integrity"),t=!0)),t},p.prototype.recurseRewriteElem=function(e){var t=!1,r=[];for(e&&(e.children||e.childNodes)&&r.push(e.children||e.childNodes);0<r.length;)for(var o=r.shift(),n=0;n<o.length;n++)if(o[n].nodeType===Node.ELEMENT_NODE){t=this.rewriteElem(o[n])||t;var w=o[n].children||o[n].childNodes;w&&w.length&&r.push(w)}return t},p.prototype.rewriteHtml=function(e,t){if(!e)return e;var r=e;if("string"!=typeof e&&(r=e.toString()),this.write_buff&&(r=this.write_buff+r,this.write_buff=""),0>=r.indexOf("<script")&&(r=r.replace(/((id|class)=".*)WB_wombat_([^"]+)/,"$1$3")),!this.$wbwindow.HTMLTemplateElement||this.FullHTMLRegex.test(r))return this.rewriteHtmlFull(r,t);var o=new DOMParser().parseFromString("<template>"+r+"</template>","text/html");if(!o||!o.head||!o.head.children||!o.head.children[0].content)return r;var i=o.head.children[0];if(this.recurseRewriteElem(i.content)){i._no_rewrite=!0;var n=i.innerHTML;if(t){var w=i.content.children&&i.content.children[0];if(w){var a="</"+w.tagName.toLowerCase()+">";this.endsWith(n,a)&&!this.endsWith(r,a)&&(n=n.substring(0,n.length-a.length))}else if("<"!==r[0]||">"!==r[r.length-1])return void(this.write_buff+=r)}return n}return r},p.prototype.rewriteHtmlFull=function(e,t){var r=new DOMParser().parseFromString(e,"text/html");if(!r)return e;for(var o=!1,n=0;n<r.all.length;n++)o=this.rewriteElem(r.all[n])||o;if(o){var w;if(e&&0<=e.indexOf("<html"))r.documentElement._no_rewrite=!0,w=r.documentElement.outerHTML;else if(r.head._no_rewrite=!0,r.body._no_rewrite=!0,w=r.head.innerHTML+r.body.innerHTML,t)if(3<r.all.length){var a="</"+r.all[3].tagName.toLowerCase()+">";this.endsWith(w,a)&&!this.endsWith(e,a)&&(w=w.substring(0,w.length-a.length))}else if("<"!==e[0]||">"!==e[e.length-1])return void(this.write_buff+=e);return w}return e},p.prototype.rewriteInlineStyle=function(t){var r;try{r=decodeURIComponent(t)}catch(o){r=t}if(r!==t){var o=this.rewriteStyle(r),i=o.split(",",2);return i[0]+","+encodeURIComponent(i[1])}return this.rewriteStyle(t)},p.prototype.rewriteCookie=function(e){var t=this,r=e.replace(this.wb_abs_prefix,"").replace(this.wb_rel_prefix,"").replace(this.cookie_domain_regex,function(e,o){var i={domain:o,cookie:r,wb_type:"cookie"};return t.sendTopMessage(i,!0),0<=t.$wbwindow.location.hostname.indexOf(".")&&!t.IP_RX.test(t.$wbwindow.location.hostname)?"Domain=."+t.$wbwindow.location.hostname:""}).replace(this.cookie_path_regex,function(e,r){var o=t.rewriteUrl(r);return 0===o.indexOf(t.wb_curr_host)&&(o=o.substring(t.wb_curr_host.length)),"Path="+o});return"https:"!==t.$wbwindow.location.protocol&&(r=r.replace("secure","")),r.replace(",|",",")},p.prototype.rewriteWorker=function(e){var t,r=!0,o=!1,i=0===e.indexOf("blob:"),n=!1;if(!!i)t=e;else if(this.startsWith(e,"javascript:"))r=!1,n=!0,t=e.replace("javascript:","");else if(!this.startsWithOneOf(e,this.VALID_PREFIXES)&&!this.startsWith(e,"/")&&!this.startsWithOneOf(e,this.BAD_PREFIXES)){var w=this.resolveRelUrl(e,this.$wbwindow.document);t=this.rewriteUrl(w,!1,"wkr_",this.$wbwindow.document)}else t=this.rewriteUrl(e,!1,"wkr_",this.$wbwindow.document);var a;if(r){var p=new XMLHttpRequest;p.open("GET",t,!1),p.send(),a=p.responseText.replace(this.workerBlobRe,"")}else a=e;if(this.wb_info.static_prefix||this.wb_info.ww_rw_script){var _=i||n?this.$wbwindow.document.baseURI:0===e.indexOf("/")?this.resolveRelUrl(this.extractOriginalURL(e),this.$wbwindow.document):this.extractOriginalURL(e);var d=this.wb_info.ww_rw_script||this.wb_info.static_prefix+"ww_rw.js",s="(function() { self.importScripts('"+d+"'); new WBWombat({'prefix': '"+this.wb_abs_prefix+"wkr_/', 'originalURL':'"+_+"'}); })();";a=s+a,o=!0}if(o){var l=new Blob([a],{type:"text/javascript"});return URL.createObjectURL(l)}return e},p.prototype.addEventOverride=function(e,t){t||(t=this.$wbwindow.MessageEvent.prototype);var r=this.getOrigGetter(t,e);r&&this.defProp(t,e,void 0,function(){return null==this["_"+e]?r.call(this):this["_"+e]})},p.prototype.overrideAttrProps=function(){var e=this,t=function(t){if(!t)return!1;var r=t.ownerElement&&t.ownerElement.tagName;return e.shouldRewriteAttr(r,t.nodeName)};this.overridePropExtract(this.$wbwindow.Attr.prototype,"nodeValue",t),this.overridePropExtract(this.$wbwindow.Attr.prototype,"value",t)},p.prototype.overrideAttr=function(e,t,r){var o=this.getOrigGetter(e,t),i=this.getOrigSetter(e,t),n=this;this.defProp(e,t,function(e){var o;return("js_"===r&&n.removeWBOSRC(this),o=n.rewriteUrl(e,!1,r),i)?i.call(this,o):n.wb_setAttribute?n.wb_setAttribute.call(this,t,o):void 0},function(){var e;return o?e=o.call(this):n.wb_getAttribute&&(e=n.wb_getAttribute.call(this,t)),n.extractOriginalURL(e)})},p.prototype.overridePropExtract=function(e,t,r){var o=this.getOrigGetter(e,t),i=this;if(o){var n=function(){var e=i.proxyToObj(this),t=o.call(e);return(!r||r(e))&&(t=i.extractOriginalURL(t)),t};this.defProp(e,t,void 0,n)}},p.prototype.overridePropToProxy=function(e,t){var r=this.getOrigGetter(e,t);if(r){var o=this,i=function(){return o.objToProxy(r.call(this))};this.defProp(e,t,void 0,i)}},p.prototype.overrideHistoryFunc=function(e){if(this.$wbwindow.history){var t=this.$wbwindow.history[e];if(t){this.$wbwindow.history["_orig_"+e]=t;var r=this,o=function(e,o,i){var n,w,a=r.$wbwindow.WB_wombat_location;if(i){var p=r.$wbwindow.document.createElement("a");if(p.href=i,w=p.href,n=r.rewriteUrl(w),w!==a.origin&&"about:blank"!==a.href&&!r.startsWith(w,a.origin+"/"))throw new DOMException("Invalid history change: "+w)}else w=a.href;t.call(this,e,o,n),r.sendHistoryUpdate(w,o)};return this.$wbwindow.history[e]=o,this.$wbwindow.History&&this.$wbwindow.History.prototype&&(this.$wbwindow.History.prototype[e]=o),o}}},p.prototype.overrideStyleAttr=function(e,t,r){var o=this.getOrigGetter(e,t),i=this.getOrigSetter(e,t),n=this,w=o;o||(w=function(){return this.getPropertyValue(r)}),(i&&o||r)&&this.defProp(e,t,function(e){var t=n.rewriteStyle(e);return i?i.call(this,t):this.setProperty(r,t),t},w)},p.prototype.overrideStyleSetProp=function(e){var t=e.setProperty,r=this;e.setProperty=function(e,o,i){var n=r.rewriteStyle(o);return t.call(this,e,n,i)}},p.prototype.overrideAnchorAreaElem=function(e){if(e&&e.prototype){for(var t,r={},o=e.prototype,n=function(e,t){var o=r["set_"+e];return o?o.call(this,t):""},w=function(e){var t=r["get_"+e];return t?t.call(this):""},a=0;a<this.URL_PROPS.length;a++)t=this.URL_PROPS[a],r["get_"+t]=this.getOrigGetter(o,t),r["set_"+t]=this.getOrigSetter(o,t),Object.defineProperty&&this.defProp(o,t,this.makeSetLocProp(t,n,w),this.makeGetLocProp(t,w),!0);o.toString=function(){return this.href}}},p.prototype.overrideHtmlAssign=function(e,t,r){if(this.$wbwindow.DOMParser&&e&&e.prototype){var o=e.prototype,i=this.getOrigGetter(o,t),n=this.getOrigSetter(o,t);if(n){var w=this,a=function(e){var t=e;this._no_rewrite||("STYLE"===this.tagName?t=w.rewriteStyle(e):t=w.rewriteHtml(e)),n.call(this,t),this.wbUseAFWorker&&"STYLE"===this.tagName&&null!=this.sheet&&this.WBAutoFetchWorker.deferredSheetExtraction(this.sheet)},p=function(){var e=i.call(this);return this._no_rewrite?e:e.replace(w.wb_unrewrite_rx,"")};this.defProp(o,t,a,r?p:i)}}},p.prototype.overrideIframeContentAccess=function(e){if(this.$wbwindow.HTMLIFrameElement&&this.$wbwindow.HTMLIFrameElement.prototype){var t=this.$wbwindow.HTMLIFrameElement.prototype,r=this.getOrigGetter(t,e);if(r){var o=this.getOrigSetter(t,e),i=this,n=function(){return i.initIframeWombat(this),i.objToProxy(r.call(this))};this.defProp(t,e,o,n),t["_get_"+e]=r}}},p.prototype.overrideFramesAccess=function(e){if(!(e.Proxy&&e===e.frames)){e.__wb_frames=e.frames;var t=this,r=function(){for(var e=0;e<this.__wb_frames.length;e++)try{t.initNewWindowWombat(this.__wb_frames[e])}catch(t){}return this.__wb_frames};this.defProp(e,"frames",void 0,r),this.defProp(e.Window.prototype,"frames",void 0,r)}},p.prototype.overrideFuncThisProxyToObj=function(e,t,r){if(e){var o=r;if(!r&&e.prototype&&e.prototype[t]?o=e.prototype:!r&&e[t]&&(o=e),!!o){var i=o[t],n=this;o[t]=function(){return i.apply(n.proxyToObj(this),arguments)}}}},p.prototype.overrideFuncArgProxyToObj=function(e,t,r){if(e&&e.prototype){r=r||0;var o=e.prototype[t],n=this;e.prototype[t]=function(){for(var e=Array(arguments.length),t=0;t<e.length;t++)e[t]=t===r?n.proxyToObj(arguments[t]):arguments[t];var w=n.proxyToObj(this);return o.__WB_orig_apply?o.__WB_orig_apply(w,e):o.apply(w,e)}}},p.prototype.overrideApplyFunc=function(e){if(!e.Function.prototype.__WB_orig_apply){var t=e.Function.prototype.apply;e.Function.prototype.__WB_orig_apply=t;var r=this;e.Function.prototype.apply=function(e,t){null==this.____FNISNATIVE$$&&(this.____FNISNATIVE$$=0<=r.wb_funToString.call(this).indexOf("[native code]"));var o=e;if(this.____FNISNATIVE$$){if(t)for(var n=0;n<t.length;n++)t[n]=r.proxyToObj(t[n]);o=r.proxyToObj(e)}return this.__WB_orig_apply(o,t)},this.wb_funToString.apply=t}},p.prototype.overrideSrcsetAttr=function(e){var t=this.getOrigGetter(e,"srcset"),r=this.getOrigSetter(e,"srcset"),o=this;this.defProp(e,"srcset",function(e){var t=o.rewriteSrcset(e,this);if(r)return r.call(this,t);return o.wb_setAttribute?o.wb_setAttribute.call(this,"srcset",t):void 0},function(){var e;return t?e=t.call(this):o.wb_getAttribute&&(e=o.wb_getAttribute.call(this,"srcset")),e=o.extractOriginalURL(e),e})},p.prototype.overrideHrefAttr=function(e,t){var r=this.getOrigGetter(e,"href"),o=this.getOrigSetter(e,"href"),i=this,n=function(e){var r;if("cs_"===t&&0===e.indexOf("data:text/css"))r=i.rewriteInlineStyle(e);else if("LINK"===this.tagName){var n=this.rel;if("import"===n||"preload"===n){var w=i.linkAsTypes[this.as];t=null==w?"mp_":w}else"stylesheet"===n&&"cs_"!==t&&(t="cs_");r=i.rewriteUrl(e,!1,t)}else r=i.rewriteUrl(e,!1,t);return o?o.call(this,r):i.wb_setAttribute?i.wb_setAttribute.call(this,"href",r):void 0};this.defProp(e,"href",n,function(){var e;return r?e=r.call(this):i.wb_getAttribute&&(e=i.wb_getAttribute.call(this,"href")),i.extractOriginalURL(e)})},p.prototype.overrideTextProtoGetSet=function(e,t){var r,o=this.getOrigGetter(e,t),i=this;if("data"===t){var n=this.getOrigSetter(e,t);r=function(e){var t=e;return!this._no_rewrite&&this.parentElement&&"STYLE"===this.parentElement.tagName&&(t=i.rewriteStyle(e)),n.call(this,t)}}this.defProp(e,t,r,function(){var e=o.call(this);return!this._no_rewrite&&this.parentElement&&"STYLE"===this.parentElement.tagName?e.replace(i.wb_unrewrite_rx,""):e})},p.prototype.overrideTextProtoFunction=function(e,t){var r=this,o=e[t];e[t]=function(){var e;if(0<arguments.length&&this.parentElement&&"STYLE"===this.parentElement.tagName){e=Array(arguments.length);var t=arguments.length-1;2==t?(e[0]=arguments[0],e[1]=arguments[1]):1==t&&(e[0]=arguments[0]),e[t]=r.rewriteStyle(arguments[t])}else e=arguments;return o.__WB_orig_apply?o.__WB_orig_apply(r.proxyToObj(this),e):o.apply(r.proxyToObj(this),e)}},p.prototype.overrideAnUIEvent=function(e){var t="__wb_"+e+"_overriden",r=this.$wbwindow[e];if(r&&r.prototype&&!r.prototype[t]){var o=this;this.overridePropToProxy(r.prototype,"view");var i="init"+e;if(r.prototype[i]){var n=r.prototype[i];r.prototype[i]=function(){if(0===arguments.length||3>arguments.length)return n.__WB_orig_apply?n.__WB_orig_apply(this,arguments):n.apply(this,arguments);for(var e=Array(arguments.length),t=0;t<arguments.length;t++)e[t]=3==t&&null!=arguments[t]?o.proxyToObj(arguments[t]):arguments[t];return n.__WB_orig_apply?n.__WB_orig_apply(this,e):n.apply(this,e)}}this.$wbwindow[e]=function(e){return function(t,r){return r&&(null!=r.view&&(r.view=o.proxyToObj(r.view)),null!=r.relatedTarget&&(r.relatedTarget=o.proxyToObj(r.relatedTarget)),null!=r.target&&(r.target=o.proxyToObj(r.target))),new e(t,r)}}(r),this.$wbwindow[e].prototype=r.prototype,Object.defineProperty(this.$wbwindow[e].prototype,"constructor",{value:this.$wbwindow[e]}),this.$wbwindow[e].prototype[t]=!0}},p.prototype.initTextNodeOverrides=function(){if(this.$wbwindow.Text&&this.$wbwindow.Text.prototype){var e=this.$wbwindow.Text.prototype;this.overrideTextProtoFunction(e,"appendData"),this.overrideTextProtoFunction(e,"insertData"),this.overrideTextProtoFunction(e,"replaceData"),this.overrideTextProtoGetSet(e,"data"),this.overrideTextProtoGetSet(e,"wholeText")}},p.prototype.initAjaxRewrite=function(){if(this.$wbwindow.XMLHttpRequest&&this.$wbwindow.XMLHttpRequest.prototype&&this.$wbwindow.XMLHttpRequest.prototype.open){var e=this.$wbwindow.XMLHttpRequest.prototype.open,t=this;this.$wbwindow.XMLHttpRequest.prototype.open=function(r,o,i,n,w){var a=o;this._no_rewrite||(a=t.rewriteUrl(o));var p=!0;null==i||i||(p=!1),e.call(this,r,a,p,n,w),t.startsWith(a,"data:")||this.setRequestHeader("X-Pywb-Requested-With","XMLHttpRequest")},this.overridePropExtract(this.$wbwindow.XMLHttpRequest.prototype,"responseURL")}},p.prototype.initAttrOverrides=function(){this.overrideHrefAttr(this.$wbwindow.HTMLLinkElement.prototype,"cs_"),this.overrideHrefAttr(this.$wbwindow.CSSStyleSheet.prototype,"cs_"),this.overrideHrefAttr(this.$wbwindow.HTMLBaseElement.prototype,"mp_"),this.overrideSrcsetAttr(this.$wbwindow.HTMLImageElement.prototype,"im_"),this.overrideSrcsetAttr(this.$wbwindow.HTMLSourceElement.prototype,"oe_"),this.overrideAttr(this.$wbwindow.HTMLVideoElement.prototype,"poster","im_"),this.overrideAttr(this.$wbwindow.HTMLAudioElement.prototype,"poster","im_"),this.overrideAttr(this.$wbwindow.HTMLImageElement.prototype,"src","im_"),this.overrideAttr(this.$wbwindow.HTMLInputElement.prototype,"src","oe_"),this.overrideAttr(this.$wbwindow.HTMLEmbedElement.prototype,"src","oe_"),this.overrideAttr(this.$wbwindow.HTMLVideoElement.prototype,"src","oe_"),this.overrideAttr(this.$wbwindow.HTMLAudioElement.prototype,"src","oe_"),this.overrideAttr(this.$wbwindow.HTMLSourceElement.prototype,"src","oe_"),window.HTMLTrackElement&&window.HTMLTrackElement.prototype&&this.overrideAttr(this.$wbwindow.HTMLTrackElement.prototype,"src","oe_"),this.overrideAttr(this.$wbwindow.HTMLIFrameElement.prototype,"src","if_"),this.$wbwindow.HTMLFrameElement&&this.$wbwindow.HTMLFrameElement.prototype&&this.overrideAttr(this.$wbwindow.HTMLFrameElement.prototype,"src","fr_"),this.overrideAttr(this.$wbwindow.HTMLScriptElement.prototype,"src","js_"),this.overrideAttr(this.$wbwindow.HTMLObjectElement.prototype,"data","oe_"),this.overrideAttr(this.$wbwindow.HTMLMetaElement.prototype,"content","mp_"),this.overrideAttr(this.$wbwindow.HTMLFormElement.prototype,"action","mp_"),this.overrideAnchorAreaElem(this.$wbwindow.HTMLAnchorElement),this.overrideAnchorAreaElem(this.$wbwindow.HTMLAreaElement);var e=this.$wbwindow.CSSStyleDeclaration.prototype;if(this.$wbwindow.CSS2Properties&&(e=this.$wbwindow.CSS2Properties.prototype),this.overrideStyleAttr(e,"cssText"),this.overrideStyleAttr(e,"background","background"),this.overrideStyleAttr(e,"backgroundImage","background-image"),this.overrideStyleAttr(e,"cursor","cursor"),this.overrideStyleAttr(e,"listStyle","list-style"),this.overrideStyleAttr(e,"listStyleImage","list-style-image"),this.overrideStyleAttr(e,"border","border"),this.overrideStyleAttr(e,"borderImage","border-image"),this.overrideStyleAttr(e,"borderImageSource","border-image-source"),this.overrideStyleAttr(e,"maskImage","mask-image"),this.overrideStyleSetProp(e),this.$wbwindow.CSSStyleSheet&&this.$wbwindow.CSSStyleSheet.prototype){var t=this,r=this.$wbwindow.CSSStyleSheet.prototype.insertRule;this.$wbwindow.CSSStyleSheet.prototype.insertRule=function(e,o){return r.call(this,t.rewriteStyle(e),o)}}this.$wbwindow.CSSRule&&this.$wbwindow.CSSRule.prototype&&this.overrideStyleAttr(this.$wbwindow.CSSRule.prototype,"cssText")},p.prototype.initCSSOMOverrides=function(){if(this.$wbwindow.StylePropertyMap&&this.$wbwindow.StylePropertyMap.prototype){var e=this,t=this.$wbwindow.StylePropertyMap.prototype.set;this.$wbwindow.StylePropertyMap.prototype.set=function(){if(1>=arguments.length)return t.__WB_orig_apply?t.__WB_orig_apply(this,arguments):t.apply(this,arguments);var r=Array(arguments.length);r[0]=arguments[0];for(var o=1;o<arguments.length;o++)r[o]=e.rewriteStyle(arguments[o]);return t.__WB_orig_apply?t.__WB_orig_apply(this,arguments):t.apply(this,arguments)};var r=this.$wbwindow.StylePropertyMap.prototype.append;this.$wbwindow.StylePropertyMap.prototype.append=function(){if(1>=arguments.length)return t.__WB_orig_apply?r.__WB_orig_apply(this,arguments):r.apply(this,arguments);var o=Array(arguments.length);o[0]=arguments[0];for(var n=1;n<arguments.length;n++)o[n]=e.rewriteStyle(arguments[n]);return r.__WB_orig_apply?r.__WB_orig_apply(this,arguments):r.apply(this,arguments)}}},p.prototype.initAudioOverride=function(){if(this.$wbwindow.Audio){var e=this.$wbwindow.Audio,t=this;this.$wbwindow.Audio=function(e){return function(r){return new e(t.rewriteUrl(r,!0,"oe_"))}}(this.$wbwindow.Audio),this.$wbwindow.Audio.prototype=e.prototype,Object.defineProperty(this.$wbwindow.Audio.prototype,"constructor",{value:this.$wbwindow.Audio})}},p.prototype.initBadPrefixes=function(e){this.BAD_PREFIXES=["http:"+e,"https:"+e,"http:/"+e,"https:/"+e]},p.prototype.initCryptoRandom=function(){if(this.$wbwindow.crypto&&this.$wbwindow.Crypto){var e=this,t=function(t){for(var r=0;r<t.length;r++)t[r]=parseInt(4294967296*e.$wbwindow.Math.random());return t};this.$wbwindow.Crypto.prototype.getRandomValues=t,this.$wbwindow.crypto.getRandomValues=t}},p.prototype.initDateOverride=function(e){if(!this.$wbwindow.__wb_Date_now){var t=1e3*parseInt(e),r=this.$wbwindow.Date.now(),o=r-(t-0),i=this.$wbwindow.Date,n=this.$wbwindow.Date.UTC,w=this.$wbwindow.Date.parse,a=this.$wbwindow.Date.now;this.$wbwindow.__wb_Date_now=a,this.$wbwindow.Date=function(e){return function(t,r,i,n,w,p,_){return void 0===t?new e(a()-o):void 0===r?new e(t):void 0===i?new e(t,r):void 0===n?new e(t,r,i):void 0===w?new e(t,r,i,n):void 0===p?new e(t,r,i,n,w):void 0===_?new e(t,r,i,n,w,p):new e(t,r,i,n,w,p,_)}}(this.$wbwindow.Date),this.$wbwindow.Date.prototype=i.prototype,this.$wbwindow.Date.now=function(){return a()-o},this.$wbwindow.Date.UTC=n,this.$wbwindow.Date.parse=w,this.$wbwindow.Date.__WB_timediff=o,Object.defineProperty(this.$wbwindow.Date.prototype,"constructor",{value:this.$wbwindow.Date})}},p.prototype.initDocTitleOverride=function(){var e=this.getOrigGetter(this.$wbwindow.document,"title"),t=this.getOrigSetter(this.$wbwindow.document,"title"),r=this;this.defProp(this.$wbwindow.document,"title",function(e){var o=t.call(this,e);return r.sendTopMessage({wb_type:"title",title:e}),o},e)},p.prototype.initFontFaceOverride=function(){if(this.$wbwindow.FontFace&&!this.$wbwindow.FontFace.__wboverriden__){var e=this,t=this.$wbwindow.FontFace;this.$wbwindow.FontFace=function(t){return function(r,o,i){var n=o;return null!=o&&("string"==typeof o?n=e.rewriteInlineStyle(o):n=e.rewriteInlineStyle(o.toString())),new t(r,n,i)}}(this.$wbwindow.FontFace),this.$wbwindow.FontFace.prototype=t.prototype,Object.defineProperty(this.$wbwindow.FontFace.prototype,"constructor",{value:this.$wbwindow.FontFace}),this.$wbwindow.FontFace.__wboverriden__=!0}},p.prototype.initFixedRatio=function(){try{this.$wbwindow.devicePixelRatio=1}catch(t){}if(Object.defineProperty)try{Object.defineProperty(this.$wbwindow,"devicePixelRatio",{value:1,writable:!1})}catch(t){}},p.prototype.initPaths=function(e){this.wb_info=e,this.wb_opts=e.wombat_opts,this.wb_replay_prefix=e.prefix,this.wb_is_proxy=e.proxy_magic||!this.wb_replay_prefix,this.wb_info.top_host=this.wb_info.top_host||"*",this.wb_curr_host=this.$wbwindow.location.protocol+"//"+this.$wbwindow.location.host,e.wombat_opts=e.wombat_opts||{},this.wb_orig_scheme=e.wombat_scheme+"://",this.wb_orig_origin=this.wb_orig_scheme+e.wombat_host,this.wb_abs_prefix=this.wb_replay_prefix,this.wb_capture_date_part=!e.is_live&&e.wombat_ts?"/"+e.wombat_ts+"/":"",this.initBadPrefixes(this.wb_replay_prefix)},p.prototype.initSeededRandom=function(e){this.$wbwindow.Math.seed=parseInt(e);var t=this;this.$wbwindow.Math.random=function(){return t.$wbwindow.Math.seed=(9301*t.$wbwindow.Math.seed+49297)%233280,t.$wbwindow.Math.seed/233280}},p.prototype.initHistoryOverrides=function(){this.overrideHistoryFunc("pushState"),this.overrideHistoryFunc("replaceState");var e=this;this.$wbwindow.addEventListener("popstate",function(){e.sendHistoryUpdate(e.$wbwindow.WB_wombat_location.href,e.$wbwindow.document.title)})},p.prototype.initFetchRewrite=function(){if(this.$wbwindow.fetch){var e=this.$wbwindow.fetch,t=this;this.$wbwindow.fetch=function(r,o){var i=typeof r;if("string"==i)r=t.rewriteUrl(r);else if("object"==i&&r.url){var n=t.rewriteUrl(r.url);n!==r.url&&(r=new Request(n,r))}else"object"==i&&r.href&&(r=t.rewriteUrl(r.href));return o=o||{},o.credentials="include",e.call(t.proxyToObj(this),r,o)}}},p.prototype.initRequestOverride=function(){if(this.$wbwindow.Request){var e=this.$wbwindow.Request,t=this;this.$wbwindow.Request=function(e){return function(r,o){var i,n=o||{},w=typeof r;if("string"===w)i=t.rewriteUrl(r);else if("object"===w&&r.url){i=r;var a=t.rewriteUrl(i.url);a!==i.url&&(i.url=a)}return n.credentials="include",new e(i,n)}}(this.$wbwindow.Request),this.$wbwindow.Request.prototype=e.prototype}},p.prototype.initSetAttributeOverride=function(){if(this.$wbwindow.Element&&this.$wbwindow.Element.prototype&&this.$wbwindow.Element.prototype.setAttribute){var e=this,t=this.$wbwindow.Element.prototype.setAttribute;this.wb_setAttribute=t,this.$wbwindow.Element.prototype._orig_setAttribute=t,this.$wbwindow.Element.prototype.setAttribute=function(r,o){var i=o;if(r&&"string"==typeof i){var n=r.toLowerCase();"LINK"===this.tagName&&"href"===n&&0===i.indexOf("data:text/css")?i=e.rewriteInlineStyle(o):e.shouldRewriteAttr(this.tagName,n)?(e.removeWBOSRC(this),!this._no_rewrite&&(i=e.rewriteUrl(o,!1,e.rwModForElement(this,n)))):"style"===n?i=e.rewriteStyle(o):"srcset"===n&&(i=e.rewriteSrcset(o,this))}return t.call(this,r,i)}}},p.prototype.initGetAttributeOverride=function(){if(this.$wbwindow.Element&&this.$wbwindow.Element.prototype&&this.$wbwindow.Element.prototype.getAttribute){var e=this.$wbwindow.Element.prototype.getAttribute;this.wb_getAttribute=e;var t=this;this.$wbwindow.Element.prototype.getAttribute=function(r){var o=e.call(this,r);if(t.shouldRewriteAttr(this.tagName,r)){var i=t.retrieveWBOSRC(this);return i?i:t.extractOriginalURL(o)}return t.startsWith(r,"data-")&&t.startsWithOneOf(o,t.VALID_PREFIXES)?t.extractOriginalURL(o):o}}},p.prototype.initSvgImageOverrides=function(){if(this.$wbwindow.SVGImageElement){var e=this.$wbwindow.SVGImageElement.prototype.getAttribute,t=this.$wbwindow.SVGImageElement.prototype.getAttributeNS,r=this.$wbwindow.SVGImageElement.prototype.setAttribute,o=this.$wbwindow.SVGImageElement.prototype.setAttributeNS,i=this;this.$wbwindow.SVGImageElement.prototype.getAttribute=function(t){var r=e.call(this,t);return 0<=t.indexOf("xlink:href")||"href"===t?i.extractOriginalURL(r):r},this.$wbwindow.SVGImageElement.prototype.getAttributeNS=function(e,r){var o=t.call(this,e,r);return"href"===r?i.extractOriginalURL(o):o},this.$wbwindow.SVGImageElement.prototype.setAttribute=function(e,t){var o=t;return(0<=e.indexOf("xlink:href")||"href"===e)&&(o=i.rewriteUrl(t)),r.call(this,e,o)},this.$wbwindow.SVGImageElement.prototype.setAttributeNS=function(e,t,r){var n=r;return"href"===t&&(n=i.rewriteUrl(r)),o.call(this,e,t,n)}}},p.prototype.initCreateElementNSFix=function(){if(this.$wbwindow.document.createElementNS&&this.$wbwindow.Document.prototype.createElementNS){var e=this.$wbwindow.document.createElementNS,t=this,r=function(r,o){return e.call(t.proxyToObj(this),t.extractOriginalURL(r),o)};this.$wbwindow.Document.prototype.createElementNS=r,this.$wbwindow.document.createElementNS=r}},p.prototype.initInsertAdjacentHTMLOverride=function(){if(this.$wbwindow.Element&&this.$wbwindow.Element.prototype&&this.$wbwindow.Element.prototype.insertAdjacentHTML){var e=this.$wbwindow.Element.prototype,t=e.insertAdjacentHTML,r=this;e.insertAdjacentHTML=function(e,o){var i=o;return this._no_rewrite||(i=r.rewriteHtml(o)),t.call(this,e,i)}}},p.prototype.initInsertAdjacentElementOverride=function(){if(this.$wbwindow.Element&&this.$wbwindow.Element.prototype&&this.$wbwindow.Element.prototype.insertAdjacentElement){var e=this.$wbwindow.Element.prototype,t=this,r=e.insertAdjacentElement;e.insertAdjacentElement=function(e,o){return this._no_rewrite?r.call(this,e,o):(t.rewriteElem(o),(o.children||o.childNodes)&&t.recurseRewriteElem(o),r.call(this,e,o))}}},p.prototype.initDomOverride=function(){this.$wbwindow.Node&&this.$wbwindow.Node.prototype&&(this.replaceDomFunc("appendChild"),this.replaceDomFunc("insertBefore"),this.replaceDomFunc("replaceChild"),this.overridePropToProxy(this.$wbwindow.Node.prototype,"ownerDocument"),this.overridePropToProxy(this.$wbwindow.HTMLHtmlElement.prototype,"parentNode"),this.overridePropToProxy(this.$wbwindow.Event.prototype,"target"))},p.prototype.initDocOverrides=function(e){if(Object.defineProperty){this.overridePropExtract(e,"referrer"),this.defProp(e,"origin",void 0,function(){return this.WB_wombat_location.origin}),this.defProp(this.$wbwindow,"origin",void 0,function(){return this.WB_wombat_location.origin});var t=this,r=function(e){var r=this.WB_wombat_location;r&&t.endsWith(r.hostname,e)&&(this.__wb_domain=e)},o=function(){return this.__wb_domain||this.WB_wombat_location.hostname};this.defProp(e,"domain",r,o)}},p.prototype.initWriteOverride=function(){if(this.$wbwindow.DOMParser){var e=this.$wbwindow.document.write,t=this,r=t.$wbwindow.Array.prototype.join,o=function(){var o,i=arguments.length;if(0===i)return e.call(this);o=1===i?arguments[0]:r.call(arguments,"");var n=t.rewriteHtml(o,!0);if(n){var w=e.call(t.proxyToObj(this),n);return t.initNewWindowWombat(this.defaultView),w}};this.$wbwindow.document.write=o,this.$wbwindow.Document.prototype.write=o;var i=this.$wbwindow.document.writeln,n=function(){var e,o=arguments.length;if(0===o)return i.call(this);e=1===o?arguments[0]:r.call(arguments,"");var n=t.rewriteHtml(e,!0);if(n){var w=i.call(t.proxyToObj(this),n);return t.initNewWindowWombat(this.defaultView),w}};this.$wbwindow.document.writeln=n,this.$wbwindow.Document.prototype.writeln=n;var w=this.$wbwindow.document.open,a=function(){var e=w.call(t.proxyToObj(this));return t.initNewWindowWombat(this.defaultView),e};this.$wbwindow.document.open=a,this.$wbwindow.Document.prototype.open=a}},p.prototype.initIframeWombat=function(e){var t=e._get_contentWindow?e._get_contentWindow.call(e):e.contentWindow;try{if(!t||t===this.$wbwindow||t._skip_wombat||t._wb_wombat)return}catch(t){return}var r=this.wb_getAttribute.call(e,"src");this.initNewWindowWombat(t,r)},p.prototype.initNewWindowWombat=function(e,t){if(e&&!e._wb_wombat)if(!t||""===t||"about:blank"===t||0<=t.indexOf("javascript:")){var r=new p(e,this.wb_info);e._wb_wombat=r.wombatInit()}else this.initProtoPmOrigin(e),this.initPostMessageOverride(e),this.initMessageEventOverride(e)},p.prototype.initTimeoutIntervalOverrides=function(e){if(this.$wbwindow[e]&&!this.$wbwindow[e].__$wbpatched$__){var t=this.$wbwindow[e],r=this;this.$wbwindow[e]=function(){var e=null!=arguments[0]&&Object.getPrototypeOf(arguments[0])===String.prototype,o=e?Array(arguments.length):arguments;if(e){o[0]=r.$wbwindow.Proxy?r.wrapScriptTextJsProxy(arguments[0]):arguments[0].replace(/\blocation\b/g,"WB_wombat_$&");for(var n=1;n<arguments.length;++n)o[n]=r.proxyToObj(arguments[n])}var w=r.proxyToObj(this);return t.__WB_orig_apply?t.__WB_orig_apply(w,o):t.apply(w,o)},this.$wbwindow[e].__$wbpatched$__=!0}},p.prototype.initAutoFetchWorker=function(){if(this.wbUseAFWorker){this.WBAutoFetchWorker=new n(this);var e=this;this.utilFns.wbSheetMediaQChecker=function(){this.removeEventListener("load",e.utilFns.wbSheetMediaQChecker),null==this.sheet||e.WBAutoFetchWorker.deferredSheetExtraction(this.sheet)}}},p.prototype.initWebWorkerOverride=function(){if(this.$wbwindow.Worker){var e=this.$wbwindow.Worker,t=this;this.$wbwindow.Worker=function(e){return function(r){return new e(t.rewriteWorker(r))}}(e),this.$wbwindow.Worker.prototype=e.prototype}},p.prototype.initSharedWorkerOverride=function(){if(this.$wbwindow.SharedWorker){var e=this.$wbwindow.SharedWorker,t=this;this.$wbwindow.SharedWorker=function(e){return function(r){return new e(t.rewriteWorker(r))}}(e),this.$wbwindow.SharedWorker.prototype=e.prototype}},p.prototype.initServiceWorkerOverride=function(){if(this.$wbwindow.ServiceWorkerContainer&&this.$wbwindow.ServiceWorkerContainer.prototype&&this.$wbwindow.ServiceWorkerContainer.prototype.register){var e=this.$wbwindow.ServiceWorkerContainer.prototype.register,t=this;this.$wbwindow.ServiceWorkerContainer.prototype.register=function(r,o){var i=new URL(r,t.$wbwindow.document.baseURI).href;return o&&o.scope?o.scope=t.rewriteUrl(o.scope,!1,"mp_"):o={scope:t.rewriteUrl("/",!1,"mp_")},e.call(this,t.rewriteUrl(i,!1,"sw_"),o)}}},p.prototype.initWorkletOverride=function(){if(this.$wbwindow.Worklet&&this.$wbwindow.Worklet.prototype&&!this.$wbwindow.Worklet.prototype.__wb_workerlet_overriden){var e=this.$wbwindow.Worklet.prototype.addModule,t=this;this.$wbwindow.Worklet.prototype.addModule=function(r,o){var i=t.rewriteUrl(r,!1,"js_");return e.call(this,i,o)},this.$wbwindow.Worklet.prototype.__wb_workerlet_overriden=!0}},p.prototype.initLocOverride=function(e,t,r){if(Object.defineProperty)for(var o,n=0;n<this.URL_PROPS.length;n++)o=this.URL_PROPS[n],this.defProp(e,o,this.makeSetLocProp(o,t,r),this.makeGetLocProp(o,r),!0)},p.prototype.initWombatLoc=function(e){if(!(!e||e.WB_wombat_location&&e.document.WB_wombat_location)){var t=new i(e.location,this);if(Object.defineProperty){var r=function(e){var t=this._WB_wombat_location||this.defaultView&&this.defaultView._WB_wombat_location||this.location;t&&(t.href=e)},o=function(){return this._WB_wombat_location||this.defaultView&&this.defaultView._WB_wombat_location||this.location};this.defProp(e.Object.prototype,"WB_wombat_location",r,o),this.initProtoPmOrigin(e),e._WB_wombat_location=t}else e.WB_wombat_location=t,setTimeout(this.checkAllLocations,500),setInterval(this.checkAllLocations,500)}},p.prototype.initProtoPmOrigin=function(e){if(!e.Object.prototype.__WB_pmw){var t=function(e){return this.__WB_source=e,this};try{e.Object.defineProperty(e.Object.prototype,"__WB_pmw",{get:function(){return t},set:function(){},configurable:!0,enumerable:!1})}catch(t){}e.__WB_check_loc=function(e){return e instanceof Location||e instanceof i?this.WB_wombat_location:{}}}},p.prototype.initHashChange=function(){if(this.$wbwindow.__WB_top_frame){var e=this,t=function(t){var r=e.proxyToObj(t.source);if(t.data&&r===e.$wbwindow.__WB_top_frame){var o=t.data;o.wb_type&&("outer_hashchange"!==o.wb_type||e.$wbwindow.location.hash===o.hash||(e.$wbwindow.location.hash=o.hash))}},r=function(){var t={wb_type:"hashchange",hash:e.$wbwindow.location.hash};e.sendTopMessage(t)};this.$wbwindow.addEventListener("message",t),this.$wbwindow.addEventListener("hashchange",r)}},p.prototype.initPostMessageOverride=function(e){if(e.postMessage&&!e.__orig_postMessage){var t=e.postMessage,r=this;e.__orig_postMessage=t;var o=function(e,o,i,n){var w,a,p=r.proxyToObj(this);if(p.__WB_source&&p.__WB_source.WB_wombat_location){var _=p.__WB_source;w=_.WB_wombat_location.origin,p.__WB_win_id||(p.__WB_win_id={},p.__WB_counter=0),_.__WB_id||(p.__WB_counter+=1,_.__WB_id=p.__WB_counter+_.WB_wombat_location.href),p.__WB_win_id[_.__WB_id]=_,a=_.__WB_id,p.__WB_source=void 0}else w=window.WB_wombat_location.origin;var d=o;d===p.location.origin&&(d=w);var s={from:w,to_origin:d,src_id:a,message:e,from_top:n};if("*"!==o){if("null"===p.location.origin||""===p.location.origin)return;o=p.location.origin}return t.call(p,s,o,i)};e.postMessage=o,e.Window.prototype.postMessage=o;var i=null;i=e.EventTarget&&e.EventTarget.prototype?e.EventTarget.prototype:e;var n=i.addEventListener;i.addEventListener=function(e,t,o){var i=r.proxyToObj(this),p=t;return"message"===e?p=r.message_listeners.add_or_get(t,function(){return a(t,i,r)}):"storage"==e&&(p=r.storage_listeners.add_or_get(t,function(){return w(t,i)})),n.call(i,e,p,o)};var p=i.removeEventListener;i.removeEventListener=function(e,t,o){var i=r.proxyToObj(this),n=t;if("message"===e?n=r.message_listeners.remove(t):"storage"==e&&(n=r.storage_listeners.remove(t)),n)return p.call(i,e,n,o)};var _=function(t,o){var i=r.getOrigSetter(e,t);r.defProp(e,t,function(e){this["__orig_"+t]=e;var n=r.proxyToObj(this),w=e?o(e,n,r):e;return i.call(n,w)},function(){return this["__orig_"+t]})};_("onmessage",a),_("onstorage",w)}},p.prototype.initMessageEventOverride=function(e){!e.MessageEvent||e.MessageEvent.prototype.__extended||(this.addEventOverride("target"),this.addEventOverride("srcElement"),this.addEventOverride("currentTarget"),this.addEventOverride("eventPhase"),this.addEventOverride("path"),this.overridePropToProxy(e.MessageEvent.prototype,"source"),e.MessageEvent.prototype.__extended=!0)},p.prototype.initUIEventsOverrides=function(){this.overrideAnUIEvent("UIEvent"),this.overrideAnUIEvent("MouseEvent"),this.overrideAnUIEvent("TouchEvent"),this.overrideAnUIEvent("FocusEvent"),this.overrideAnUIEvent("KeyboardEvent"),this.overrideAnUIEvent("WheelEvent"),this.overrideAnUIEvent("InputEvent"),this.overrideAnUIEvent("CompositionEvent")},p.prototype.initOpenOverride=function(){var e=this.$wbwindow.open;this.$wbwindow.Window.prototype.open&&(e=this.$wbwindow.Window.prototype.open);var t=this,r=function(r,o,i){var n=t.rewriteUrl(r,!1,""),w=e.call(t.proxyToObj(this),n,o,i);return t.initNewWindowWombat(w,n),w};this.$wbwindow.open=r,this.$wbwindow.Window.prototype.open&&(this.$wbwindow.Window.prototype.open=r);for(var o=0;o<this.$wbwindow.frames.length;o++)try{this.$wbwindow.frames[o].open=r}catch(t){console.log(t)}},p.prototype.initCookiesOverride=function(){var e=this.getOrigGetter(this.$wbwindow.document,"cookie"),t=this.getOrigSetter(this.$wbwindow.document,"cookie");e||(e=this.getOrigGetter(this.$wbwindow.Document.prototype,"cookie")),t||(t=this.getOrigSetter(this.$wbwindow.Document.prototype,"cookie"));var r=function(e,t){var r=new Date(t);if(isNaN(r.getTime()))return"Expires=Thu,| 01 Jan 1970 00:00:00 GMT";var o=new Date(r.getTime()+Date.__WB_timediff);return"Expires="+o.toUTCString().replace(",",",|")},o=this,i=function(e){if(e){for(var n=e.replace(o.cookie_expires_regex,r),w=n.split(/,(?![|])/),a=0;a<w.length;a++)w[a]=o.rewriteCookie(w[a]);return t.call(o.proxyToObj(this),w.join(","))}},n=function(){return e.call(o.proxyToObj(this))};this.defProp(this.$wbwindow.document,"cookie",i,n)},p.prototype.initEvalOverride=function(){var e=this.$wbwindow.eval;this.$wbwindow.eval=function(t){t&&(t=t.toString().replace(/\blocation\b/g,"WB_wombat_$&")),e.call(this,t)}},p.prototype.initRegisterPHOverride=function(){if(this.$wbwindow.navigator.registerProtocolHandler){var e=this.$wbwindow.navigator.registerProtocolHandler,t=this;this.$wbwindow.navigator.registerProtocolHandler=function(r,o,i){return e.call(this,r,t.rewriteUrl(o),i)}}},p.prototype.initBeaconOverride=function(){if(this.$wbwindow.navigator.sendBeacon){var e=this.$wbwindow.navigator.sendBeacon,t=this;this.$wbwindow.navigator.sendBeacon=function(r,o){return e.call(this,t.rewriteUrl(r),o)}}},p.prototype.initDisableNotifications=function(){if(window.Notification&&(window.Notification.requestPermission=function(e){return e&&e("denied"),Promise.resolve("denied")}),window.geolocation){var e=function(e,t){t&&t({code:2,message:"not available"})};window.geolocation.getCurrentPosition=e,window.geolocation.watchPosition=e}},p.prototype.initStorageOverride=function(){this.addEventOverride("storageArea",this.$wbwindow.StorageEvent.prototype);var e=new o(this),t=new o(this);if(this.$wbwindow.Proxy){var r=this,i=function(e){return new r.$wbwindow.Proxy(e,{get:function(e,t){return t in e?e[t]:e.getItem(t)},set:function(e,t,r){return!e.hasOwnProperty(t)&&(e.setItem(t,r),!0)},getOwnPropertyDescriptor:function(e,t){return Object.getOwnPropertyDescriptor(e,t)}})};e=i(e),t=i(t)}this.defProp(this.$wbwindow,"localStorage",void 0,function(){return e}),this.defProp(this.$wbwindow,"sessionStorage",void 0,function(){return t})},p.prototype.initWindowObjProxy=function(e){if(e.Proxy){var t=this.getAllOwnProps(e),r=this;return e._WB_wombat_obj_proxy=new e.Proxy({},{get:function(o,i){return"top"===i?r.$wbwindow.WB_wombat_top._WB_wombat_obj_proxy:r.defaultProxyGet(e,i,t)},set:function(t,r,o){if("location"===r)return e.WB_wombat_location=o,!0;if("postMessage"===r||"document"===r)return!0;try{if(!Reflect.set(t,r,o))return!1}catch(t){}return Reflect.set(e,r,o)},has:function(t,r){return r in e},ownKeys:function(){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))},getOwnPropertyDescriptor:function(t,r){var o=Object.getOwnPropertyDescriptor(t,r);return o||(o=Object.getOwnPropertyDescriptor(e,r),o&&(o.configurable=!0)),o},getPrototypeOf:function(){return Object.getPrototypeOf(e)},setPrototypeOf:function(){return!1},isExtensible:function(){return Object.isExtensible(e)},preventExtensions:function(){return Object.preventExtensions(e),!0},deleteProperty:function(t,r){var o=Object.getOwnPropertyDescriptor(e,r);return void 0===o||!1!==o.configurable&&(delete e[r],!0)},defineProperty:function(t,r,o){var i=o||{};return i.value||i.get||(i.value=e[r]),Reflect.defineProperty(e,r,i),Reflect.defineProperty(t,r,i)}}),e._WB_wombat_obj_proxy}},p.prototype.initDocumentObjProxy=function(e){if(this.initDocOverrides(e),!!this.$wbwindow.Proxy){var t=this.getAllOwnProps(e),r=this;return e._WB_wombat_obj_proxy=new this.$wbwindow.Proxy(e,{get:function(o,i){return r.defaultProxyGet(e,i,t)},set:function(t,r,o){return"location"===r?(e.WB_wombat_location=o,!0):(t[r]=o,!0)}}),e._WB_wombat_obj_proxy}},p.prototype.initTopFrameNotify=function(e){var t=this,r=function(){if(!t.$wbwindow.__WB_top_frame){var r=t.$wbwindow.location.hash;return void t.$wbwindow.location.replace(e.top_url+r)}if(t.$wbwindow.WB_wombat_location){var o=t.$wbwindow.WB_wombat_location.href;if("string"==typeof o&&"about:blank"!==o&&0!==o.indexOf("javascript:")&&("complete"===t.$wbwindow.document.readyState&&t.wbUseAFWorker&&t.WBAutoFetchWorker.extractFromLocalDoc(),t.$wbwindow===t.$wbwindow.__WB_replay_top)){for(var n,w=[],a=t.$wbwindow.document.querySelectorAll("link[rel*='icon']"),p=0;p<a.length;p++)n=a[p],w.push({rel:n.rel,href:t.wb_getAttribute.call(n,"href")});var _={icons:w,url:t.$wbwindow.WB_wombat_location.href,ts:t.wb_info.timestamp,request_ts:t.wb_info.request_ts,is_live:t.wb_info.is_live,title:t.$wbwindow.document?t.$wbwindow.document.title:"",readyState:t.$wbwindow.document.readyState,wb_type:"load"};t.sendTopMessage(_)}}};"complete"===this.$wbwindow.document.readyState?r():this.$wbwindow.addEventListener?this.$wbwindow.document.addEventListener("readystatechange",r):this.$wbwindow.attachEvent&&this.$wbwindow.document.attachEvent("onreadystatechange",r)},p.prototype.initTopFrame=function(e){if(this.wb_is_proxy)return e.__WB_replay_top=e.top,void(e.__WB_top_frame=void 0);for(var t=function(e){try{return!!e&&(e.wbinfo?e.wbinfo.is_framed:null!=e._wb_wombat)}catch(t){return!1}},r=e;r.parent!==r&&t(r.parent);)r=r.parent;e.__WB_replay_top=r;var o=r.__WB_orig_parent||r.parent;if(o!==e&&this.wb_info.is_framed||(o=void 0),o?(e.__WB_top_frame=o,this.initFrameElementOverride(e)):e.__WB_top_frame=void 0,!this.wb_opts.embedded&&r===e){if(this.wbUseAFWorker){var i=this;this.$wbwindow.addEventListener("message",function(e){e.data&&"aaworker"===e.data.wb_type&&i.WBAutoFetchWorker.postMessage(e.data.msg)},!1)}e.__WB_orig_parent=e.parent,e.parent=r}},p.prototype.initFrameElementOverride=function(e){if(Object.defineProperty&&this.proxyToObj(e.__WB_replay_top)===this.proxyToObj(e))try{Object.defineProperty(e,"frameElement",{value:null,configurable:!1})}catch(t){}},p.prototype.initWombatTop=function(e){if(Object.defineProperty){var t=function(e){return"undefined"==typeof window.constructor?e instanceof window.constructor:e.window===e},r=function(){return this.__WB_replay_top?this.__WB_replay_top:t(this)?this:this.top},o=function(e){this.top=e};this.defProp(e.Object.prototype,"WB_wombat_top",o,r)}},p.prototype.wombatInit=function(){this.initTopFrame(this.$wbwindow),this.initWombatLoc(this.$wbwindow),this.initWombatTop(this.$wbwindow);var e=this.$wbwindow.__WB_replay_top.location.origin,t=this.$wbwindow.__WB_replay_top.location.host,r=this.$wbwindow.__WB_replay_top.location.protocol;this.wb_rel_prefix=this.wb_replay_prefix&&0===this.wb_replay_prefix.indexOf(e)?this.wb_replay_prefix.substring(e.length):this.wb_replay_prefix;var o="(("+r+")?//"+t+")?"+this.wb_rel_prefix+"[^/]+/";this.wb_unrewrite_rx=new RegExp(o,"g"),this.initHistoryOverrides(),this.initDocTitleOverride(),this.wb_opts.skip_postmessage||(this.initPostMessageOverride(this.$wbwindow),this.initMessageEventOverride(this.$wbwindow)),this.initHashChange(),this.initUIEventsOverrides(),this.initWriteOverride(),this.initAjaxRewrite(),this.initFetchRewrite(),this.initRequestOverride(),this.initAudioOverride(),this.initFontFaceOverride(this.$wbwindow),this.initAutoFetchWorker(),this.initWebWorkerOverride(),this.initServiceWorkerOverride(),this.initSharedWorkerOverride(),this.initWorkletOverride(),this.initTextNodeOverrides(),this.initCSSOMOverrides(),this.overrideHtmlAssign(this.$wbwindow.HTMLElement,"innerHTML",!0),this.overrideHtmlAssign(this.$wbwindow.HTMLElement,"outerHTML",!0),this.overrideHtmlAssign(this.$wbwindow.HTMLIFrameElement,"srcdoc",!0),this.overrideHtmlAssign(this.$wbwindow.HTMLStyleElement,"textContent"),this.overridePropExtract(this.$wbwindow.Document.prototype,"URL"),this.overridePropExtract(this.$wbwindow.Document.prototype,"documentURI"),this.overridePropExtract(this.$wbwindow.Node.prototype,"baseURI"),this.overrideAttrProps(),this.initInsertAdjacentHTMLOverride(),this.initInsertAdjacentElementOverride(),this.overrideIframeContentAccess("contentWindow"),this.overrideIframeContentAccess("contentDocument"),this.overrideFuncArgProxyToObj(this.$wbwindow.MutationObserver,"observe"),this.overrideFuncArgProxyToObj(this.$wbwindow.Node,"compareDocumentPosition"),this.overrideFuncArgProxyToObj(this.$wbwindow.Node,"contains"),this.overrideFuncArgProxyToObj(this.$wbwindow.Document,"createTreeWalker"),this.overrideFuncArgProxyToObj(this.$wbwindow.Document,"evaluate",1),this.overrideFuncArgProxyToObj(this.$wbwindow.Document,"createTouch",1),this.overrideFuncArgProxyToObj(this.$wbwindow.XSLTProcessor,"transformToFragment",1),this.overrideFuncThisProxyToObj(this.$wbwindow,"getComputedStyle",this.$wbwindow),this.overrideApplyFunc(this.$wbwindow),this.initTimeoutIntervalOverrides("setTimeout"),this.initTimeoutIntervalOverrides("setInterval"),this.overrideFramesAccess(this.$wbwindow),this.wb_opts.skip_setAttribute||(this.initSetAttributeOverride(),this.initGetAttributeOverride()),this.initSvgImageOverrides(),this.initAttrOverrides(),this.initCookiesOverride(),this.initCreateElementNSFix(),this.wb_opts.skip_dom||this.initDomOverride(),this.initRegisterPHOverride(),this.initBeaconOverride(),this.initSeededRandom(this.wb_info.wombat_sec),this.initCryptoRandom(),this.initFixedRatio(),this.initDateOverride(this.wb_info.wombat_sec),this.initOpenOverride(),this.initDisableNotifications(),this.initStorageOverride(),this.initWindowObjProxy(this.$wbwindow),this.initDocumentObjProxy(this.$wbwindow.document),this.wb_info.is_framed&&"bn_"!==this.wb_info.mod&&this.initTopFrameNotify(this.wb_info);var i=this;return{actual:!1,extract_orig:function(e){return i.extractOriginalURL(e)},rewrite_url:function(e,t,r){return i.rewriteUrl(e,t,r)},watch_elem:function(e,t){return i.watchElem(e,t)},init_new_window_wombat:function(e,t){return i.initNewWindowWombat(e,t)},init_paths:function(e){i.initPaths(e)},local_init:function(e){var t=i.$wbwindow._WB_wombat_obj_proxy[e];return"document"===e&&t&&!t._WB_wombat_obj_proxy?i.initDocumentObjProxy(t)||t:t}}},window._WBWombat=p,window._WBWombatInit=function(e){if(!this._wb_wombat||!this._wb_wombat.actual){var t=new p(this,e);t.actual=!0,this._wb_wombat=t.wombatInit(),this._wb_wombat.actual=!0}else this._wb_wombat||console.warn("_wb_wombat missing!")}})();
